"use strict";!function(t){function e(){SBF.updateUsersActivity(q?SB_ACTIVE_AGENT.id:-1,0!=a()?a().id:-1,function(e){"online"==e?SBChat.user_online||(t(h).find(".sb-conversation .sb-top > .sb-labels").prepend(`<span class="sb-status-online">${o("Online")}</span>`),SBChat.user_online=!0):(t(h).find(".sb-conversation .sb-top .sb-status-online").remove(),SBChat.user_online=!1)})}function i(e,i,a){var s=t(p).find(".sb-info-card"),n="";SBF.null(a)||"error"!=a?t(s).removeClass("sb-info-card-error"):t(s).addClass("sb-info-card-error"),SBF.null(i)||(n=`<p>${o(i)}</p>`),t(s).html(`<h3>${o(e)}</h3>${o(n)}`).sbActivate(),clearTimeout(w),w=setTimeout(function(){t(s).sbActivate(!1)},5e3)}function a(t){if(void 0===t)return window.sb_current_user;window.sb_current_user=t}function s(e,i,a){let s=t(p).find(".sb-dialog-box").attr("data-type",i);t(s).find("p").html(("alert"==i?o("Are you sure?")+" ":"")+o(e)),t(s).sbActivate().css({"margin-top":t(s).outerHeight()/-2+"px","margin-left":t(s).outerWidth()/-2+"px"}),t($).sbActivate(),B=a}function n(e=!0,i=!0){t(p).find(".sb-loading-global").sbActivate(e),i&&t($).sbActivate(e)}function o(t){return 0!=SB_TRANSLATIONS&&t in SB_TRANSLATIONS?SB_TRANSLATIONS[t]:t}function r(){"undefined"!=typeof caches&&caches.delete("sb-pwa-cache")}function l(){V[0]=setInterval(function(){SBChat.tab_active=!1},1e4)}function c(e,i){let a=t(e).find(" > div, > ul");t(e).hasClass("sb-collapse")&&t(a).prop("scrollHeight")>i&&(t(e).sbActivate().attr("data-height",i),t(e).append(`<a class="sb-btn-text sb-collapse-btn">${o("View more")}</a>`),t(a).css({height:i+"px","max-height":i+"px"}))}function d(e,i){let a=t(e).parent().find("i"),s=t(e).val();t(a).sbLoading()||SBF.search(s,()=>{t(a).sbLoading(!0),i(s,a)})}function u(e,i=!1){if(i)return t(e).scrollTop()+t(e).innerHeight()>=t(e)[0].scrollHeight;t(e).scrollTop(t(e)[0].scrollHeight)}var p,f,h,b,v,g,m,S,_,x,y,k,w,B,A,$,C,T=[],F=!1,L=!1,I=!1,E=!1,N=1,M={},R=1,D=[],j=t(window).width()<426,G={last:0,header:!0,always_hidden:!1},P="localhost"===location.hostname||"127.0.0.1"===location.hostname,U=new Date,O=!1,H=!1,q=!0,V=[0,!0];t.fn.miniTip=function(e){var i=t.extend({title:"",content:!1,delay:300,anchor:"n",event:"hover",fadeIn:200,fadeOut:200,aHide:!0,maxW:"250px",offset:5,stemOff:0,doHide:!1},e);0==t(p).find("#miniTip").length&&t(p).append('<div id="miniTip" class="sb-tooltip"><div></div></div>');var a=t(p).find("#miniTip"),s=a.find("div");return i.doHide?(a.stop(!0,!0).fadeOut(i.fadeOut),!1):this.each(function(){var e=t(this),n=i.content?i.content:e.attr("title");if(""!=n&&void 0!==n){window.delay=!1;var o=!1,r=!0;i.content||e.removeAttr("title"),"hover"==i.event?(e.hover(function(){a.removeAttr("click"),r=!0,l.call(this)},function(){r=!1,c()}),i.aHide||a.hover(function(){o=!0},function(){o=!1,setTimeout(function(){!r&&!a.attr("click")&&c()},20)})):"click"==i.event&&(i.aHide=!0,e.click(function(){return a.attr("click","t"),a.data("last_target")!==e?l.call(this):"none"==a.css("display")?l.call(this):c(),a.data("last_target",e),t("html").unbind("click").click(function(e){"block"==a.css("display")&&!t(e.target).closest("#miniTip").length&&(t("html").unbind("click"),c())}),!1}));var l=function(){i.show&&i.show.call(this,i),i.content&&""!=i.content&&(n=i.content),s.html(n),i.render&&i.render(a),a.hide().width("").width(a.width()).css("max-width",i.maxW);var o=e.is("area");if(o){var r,l=[],c=[],d=e.attr("coords").split(",");function u(t,e){return t-e}for(r=0;r<d.length;r++)l.push(d[r++]),c.push(d[r]);var p=e.parent().attr("name"),f=t("img[usemap=\\#"+p+"]").offset(),h=parseInt(f.left,10)+parseInt((parseInt(l.sort(u)[0],10)+parseInt(l.sort(u)[l.length-1],10))/2,10),b=parseInt(f.top,10)+parseInt((parseInt(c.sort(u)[0],10)+parseInt(c.sort(u)[c.length-1],10))/2,10)}else b=parseInt(e.offset().top,10),h=parseInt(e.offset().left,10);var v=o?0:parseInt(e.outerWidth(),10),g=o?0:parseInt(e.outerHeight(),10),m=a.outerWidth(),S=a.outerHeight(),_=Math.round(h+Math.round((v-m)/2)),x=Math.round(b+g+i.offset+8),y=Math.round(m-16)/2-parseInt(a.css("borderLeftWidth"),10),k=0,w=h+v+m+i.offset+8>parseInt(t(window).width(),10),B=m+i.offset+8>h,A=S+i.offset+8>b-t(window).scrollTop(),$=b+g+S+i.offset+8>parseInt(t(window).height()+t(window).scrollTop(),10),C=i.anchor;B||"e"==i.anchor&&!w?"w"!=i.anchor&&"e"!=i.anchor||(C="e",k=Math.round(S/2-8-parseInt(a.css("borderRightWidth"),10)),y=-8-parseInt(a.css("borderRightWidth"),10),_=h+v+i.offset+8,x=Math.round(b+g/2-S/2)):(w||"w"==i.anchor&&!B)&&("w"!=i.anchor&&"e"!=i.anchor||(C="w",k=Math.round(S/2-8-parseInt(a.css("borderLeftWidth"),10)),y=m-parseInt(a.css("borderLeftWidth"),10),_=h-m-i.offset-8,x=Math.round(b+g/2-S/2))),$||"n"==i.anchor&&!A?"n"!=i.anchor&&"s"!=i.anchor||(C="n",k=S-parseInt(a.css("borderTopWidth"),10),x=b-(S+i.offset+8)):(A||"s"==i.anchor&&!$)&&("n"!=i.anchor&&"s"!=i.anchor||(C="s",k=-8-parseInt(a.css("borderBottomWidth"),10),x=b+g+i.offset+8)),"n"==i.anchor||"s"==i.anchor?m/2>h?(_=_<0?y+_:y,y=0):h+m/2>parseInt(t(window).width(),10)&&(_-=y,y*=2):A?(x+=k,k=0):$&&(x-=k,k*=2),delay&&clearTimeout(delay),delay=setTimeout(function(){a.css({"margin-left":_+"px","margin-top":x+"px"}).stop(!0,!0).fadeIn(i.fadeIn)},i.delay),a.attr("class","sb-tooltip "+C)},c=function(){(!i.aHide&&!o||i.aHide)&&(delay&&clearTimeout(delay),delay=setTimeout(function(){d()},i.delay))},d=function(){!i.aHide&&!o||i.aHide?(a.stop(!0,!0).fadeOut(i.fadeOut),i.hide&&i.hide.call(this)):setTimeout(function(){c()},200)}}})},t.fn.sbShowLightbox=function(e=!1,i=""){t(p).find(".sb-lightbox").sbActivate(!1),t($).sbActivate(),t(this).sbActivate(),e?t(this).addClass("sb-popup-lightbox").attr("data-action",i):t(this).css({"margin-top":t(this).outerHeight()/-2+"px","margin-left":t(this).outerWidth()/-2+"px"}),this.preventDefault},t.fn.sbHideLightbox=function(){t(this).find(".sb-lightbox,.sb-popup-lightbox").sbActivate(!1).removeClass("sb-popup-lightbox").removeAttr("data-action"),t($).sbActivate(!1)},window.sbDialogAdmin=function(t,e,i){s(t,e,i)};var W={ump:{panel:!1,conversationPanel:function(){if(this.panel||(this.panel=t(h).find(".sb-panel-ump")),!t(this.panel).sbLoading()){let e,i="";SBF.ajax({function:"ump-get-conversation-details"},a=>{if((e=a.subscriptions).length){i='<i class="sb-icon-refresh"></i><h3>Membership</h3><div class="sb-list-names">';for(var s=0;s<e.length;s++)i+=`<div${e[s].expired?' class="sb-expired"':""}><span>${e[s].label}</span><span>${o("Expires on")} ${SBF.beautifyTime(e[s].expire_time,!0,!e[s].expired)}</span></div>`;i+=`</div><span class="sb-title">${o("Total spend")} ${a.currency_symbol}${a.total}</span>`}t(this.panel).html(i).sbLoading(!1),c(this.panel,160)}),t(this.panel).sbLoading(!0)}}},woocommerce:{popupPaginationNumber:1,popupLanguage:"",popupCache:[],panel:!1,timeout:!1,popupCode:function(t,e=!0){let i="";for(var a=0;a<t.length;a++)i+=`<li data-id="${t[a].id}"><div class="sb-image" style="background-image:url('${t[a].image}')"></div><div><span>${t[a].name}</span><span>${SB_ADMIN_SETTINGS.currency}${t[a].price}</span></div></li>`;return e&&""==i?`<p>${o("No products found")}</p>`:i},popupSearch:function(e){d(e,(e,i)=>{""==e?this.popupPopulate(function(){t(i).sbLoading(!1)}):(this.popupPaginationNumber=1,SBF.ajax({function:"woocommerce-search-products",search:e},e=>{t(E).html(this.popupCode(e)),t(i).sbLoading(!1)}))})},popupFilter:function(e){t(E).sbLoading()||(t(E).html("").sbLoading(!0),this.popupPaginationNumber=1,SBF.ajax({function:"woocommerce-get-products",user_language:this.popupLanguage,filters:{taxonomy:t(e).data("value")}},e=>{t(E).html(this.popupCode(e)).sbLoading(!1)}))},popupPopulate:function(e=!1){this.popupLanguage=0!=a()&&SB_ADMIN_SETTINGS.languages.includes(a().language)?a().language:"",this.popupPaginationNumber=1,t(E).html("").sbLoading(!0),SBF.ajax({function:"woocommerce-products-popup",user_language:this.popupLanguage},i=>{let a="",s=t(I).find(".sb-select");for(var n=0;n<i[1].length;n++)a+=`<li data-value="${i[1][n].id}">${i[1][n].name}</li>`;t(s).find("> p").html(o("All")),t(s).find("ul").html(`<li data-value="" class="sb-active">${o("All")}</li>`+a),t(E).html(this.popupCode(i[0])).sbLoading(!1),!1!==e&&e()})},popupPagination:function(e){t(E).sbLoading(e),SBF.ajax({function:"woocommerce-get-products",filters:{taxonomy:t(e).parent().find(".sb-select p").attr("data-value")},pagination:this.popupPaginationNumber,user_language:this.popupLanguage},i=>{t(E).append(this.popupCode(i,!1)).sbLoading(!1),this.popupPaginationNumber++,u(e)})},conversationPanel:function(){if(this.panel||(this.panel=t(h).find(".sb-panel-woocommerce")),!t(this.panel).sbLoading()){let e="";SBF.ajax({function:"woocommerce-get-conversation-details"},i=>{e=`<i class="sb-icon-refresh"></i><h3>WooCommerce</h3><div><div class="sb-split"><div><div class="sb-title">${o("Number of orders")}</div><span>${i.orders_count} ${o("orders")}</span></div><div><div class="sb-title">${o("Total spend")}</div><span>${i.currency_symbol}${i.total}</span></div></div><div class="sb-title">${o("Cart")}<i class="sb-add-cart-btn sb-icon-plus"></i></div><div class="sb-list-items sb-list-links sb-woocommerce-cart">`;for(a=0;a<i.cart.length;a++){let t=i.cart[a];e+=`<a href="${t.url}" target="_blank" data-id="${t.id}"><span>#${t.id}</span> <span>${t.quantity} x</span> <span>${t.name}</span><i class="sb-icon-close"></i></a>`}if(e+=(i.cart.length?"":"<p>"+o("The cart is currently empty.")+"</p>")+"</div>",i.orders.length){e+=`<div class="sb-title">${o("Orders")}</div><div class="sb-list-items sb-woocommerce-orders sb-accordion">`;for(var a=0;a<i.orders.length;a++){let t=i.orders[a],s=t.id;e+=`<div data-id="${s}"><span><span>#${s}</span> <span>${SBF.beautifyTime(t.date,!0)}</span><a href="${C}/wp-admin/post.php?post=${s}&action=edit" target="_blank" class="sb-icon-next"></a></span><div></div></div>`}e+="</div>"}t(this.panel).html(e).sbLoading(!1),c(this.panel,160)}),t(this.panel).sbLoading(!0)}},conversationPanelOrder:function(e){let i=t(this.panel).find(`[data-id="${e}"] > div`);t(i).html(""),SBF.ajax({function:"woocommerce-get-order",order_id:e},e=>{let a="",s=t(this.panel).find(".sb-collapse-btn:not(.sb-active)");if(e){let t=e.products;a+=`<div class="sb-title">${o("Order total")}: <span>${e.currency_symbol}${e.total}<span></div><div class="sb-title">${o("Order status")}: <span>${SBF.slugToString(e.status.replace("wc-",""))}<span></div><div class="sb-title">${o("Date")}: <span>${SBF.beautifyTime(e.date,!0)}<span></div><div class="sb-title">${o("Products")}</div>`;for(n=0;n<t.length;n++)a+=`<a href="${C}?p=${t[n].id}" target="_blank"><span>#${t[n].id}</span> <span>${t[n].quantity} x</span> <span>${t[n].name}</span></a>`;for(var n=0;n<2;n++){let t=0==n?"shipping":"billing";""!=e[t+"_address"]&&(a+=`<div class="sb-title">${o((0==n?"Shipping":"Billing")+" address")}</div><div class="sb-multiline">${e[t+"_address"].replace(/\\n/g,"<br>")}</div>`)}}t(s).length&&t(s).click(),t(i).html(a)})},conversationPanelUpdate:function(e,i="added"){let a=!1,s=0;this.timeout=setInterval(()=>{a||(SBF.ajax({function:"woocommerce-get-conversation-details"},n=>{let o=!0;for(var r=0;r<n.cart.length;r++)n.cart[r].id==e&&("added"==i?s=61:o=!1);(s>60||o)&&(this.conversationPanel(),t(h).find(".sb-add-cart-btn,.sb-woocommerce-cart > a i").sbLoading(!1),clearInterval(this.timeout)),s++,a=!1}),a=!0)},1e3)}},is:function(t){if("undefined"==typeof SB_VERSIONS)return!1;switch(t){case"ump":case"woocommerce":case"dialogflow":case"slack":case"tickets":return void 0!==SB_VERSIONS[t]&&-1!=SB_VERSIONS[t];case"wordpress":return"undefined"!=typeof SB_WP;case"sb":return!0}return!1}},z={init:!1,translations_to_update:[],save:function(e){if(!t(e).sbLoading()){let o={},r={},l=t(y).find(" > .sb-tab > .sb-nav .sb-active").attr("id");switch(t(e).sbLoading(!0),l){case"tab-articles":D.length?(this.articles("save"),SBF.ajax({function:"save-articles",articles:D},()=>{i("Articles saved"),t(e).sbLoading(!1)})):t(e).sbLoading(!1);break;case"tab-translations":let c={},d=this.translations_to_update.length;if(d){for(var a=0;a<d;a++){let e=this.translations_to_update[a],i=t(y).find('.sb-translations .sb-content [data-code="'+e+'"]'),s={front:{},admin:{}};for(var n in s)t(i).find(' > [data-area="'+n+'"] .sb-input-setting:not(.sb-new-translation)').each(function(){s[n][t(this).find("label").html()]=t(this).find("input").val()});t(i).find(".sb-new-translation").each(function(){let e=t(this).find("input:first-child").val(),i=t(this).find("input:last-child").val();""!=e&&""!=i&&(s.front[e]=i)}),c[e]=s}SBF.ajax({function:"save-translations",translations:c},()=>{i("Settings saved"),t(e).sbLoading(!1)})}else s("No translations to update. Please click the language of the translations you want to save and try again.","info"),t(e).sbLoading(!1);break;default:t(y).find(".sb-setting").each((e,i)=>{let a=this.get(i),s=t(i).data("setting");if(""!=a[0]){let t=[a[1],a[2]];void 0!==s?(s in o||(o[s]={}),o[s][a[0]]=t):r[a[0]]=t}}),SBF.ajax({function:"save-settings",settings:r,external_settings:o},()=>{i("Settings saved"),t(e).sbLoading(!1)})}}},initPlugins:function(){t(y).find("textarea").each(function(){t(this).autoExpandTextarea(),t(this).manualExpandTextarea()})},initHTML:function(e){if("slack-agents"in e){let a="";for(var i in e["slack-agents"][0])a+=`<div data-id="${i}"><select><option value="${e["slack-agents"][0][i]}"></option></select></div>`;t(y).find("#slack-agents .input").html(a)}},get:function(e){let i=t(e).attr("id"),a=t(e).data("type");switch(a){case"upload":case"range":case"number":case"text":case"password":case"color":return[i,t(e).find("input").val(),a];case"textarea":return[i,t(e).find("textarea").val(),a];case"select":return[i,t(e).find("select").val(),a];case"checkbox":return[i,t(e).find("input").is(":checked"),a];case"radio":let s=t(e).find("input:checked").val();return SBF.null(s)&&(s=""),[i,s,a];case"upload-image":let n=t(e).find(".image").attr("data-value");return SBF.null(n)&&(n=""),[i,n,a];case"multi-input":let o={};return t(e).find(".input > div").each((t,e)=>{let i=this.get(e);o[i[0]]=[i[1],i[2]]}),[i,o,a];case"select-image":return[i,t(e).find(".thumbs > .active").data("id"),a];case"repeater":return[i,this.repeater("get",t(e).find(".repeater-item"),""),a];case"double-select":let r={};return t(e).find(".input > div").each(function(){let e=t(this).find("select").val();-1!=e&&(r[t(this).attr("data-id")]=[e])}),[i,r,a];case"timetable":let l={};return t(e).find(".sb-timetable > [data-day]").each(function(){let e=t(this).attr("data-day"),i=[];t(this).find("> div > div").each(function(){let e=t(this).html(),a=t(this).attr("data-value");SBF.null(a)?i.push(["",""]):"closed"==a?i.push(["closed","Closed"]):i.push([a,e])}),l[e]=i}),[i,l,a];case"color-palette":return[i,t(e).attr("data-value"),a]}return["","",""]},set:function(e,i){let a=t(i)[1],s=t(i)[0];switch(e=`#${e}`,a){case"color":case"upload":case"number":case"text":case"password":t(y).find(`${e} input`).val(SBF.restoreJson(s));break;case"textarea":t(y).find(`${e} textarea`).val(SBF.restoreJson(s));break;case"select":t(y).find(`${e} select`).val(SBF.restoreJson(s));break;case"checkbox":t(y).find(`${e} input`).prop("checked","false"!=s&&s);break;case"radio":t(y).find(`${e} input[value="${SBF.restoreJson(s)}"]`).prop("checked",!0);break;case"upload-image":""!=s&&t(y).find(e+" .image").attr("data-value",SBF.restoreJson(s)).css("background-image",`url("${SBF.restoreJson(s)}")`);break;case"multi-input":for(var n in s)this.set(n,s[n]);break;case"range":let i=SBF.restoreJson(s);t(y).find(e+" input").val(i),t(y).find(e+" .range-value").html(i);break;case"select-image":t(y).find(e+" .thumbs > [data-id]").removeClass("active"),t(y).find(e+` .thumbs > [data-id="${SBF.restoreJson(s)}"]`).addClass("active");break;case"repeater":let r=this.repeater("set",s,t(y).find(e+" .repeater-item:last-child"));""!=r&&t(y).find(e+" .sb-repeater").html(r);break;case"double-select":for(var n in s)t(y).find(`${e} .input > [data-id="${n}"] select`).val(s[n]);break;case"timetable":for(var n in s){let i=t(y).find(`${e} [data-day="${n}"] > div > div`);for(var o=0;o<i.length;o++)t(i[o]).attr("data-value",s[n][o][0]).html(s[n][o][1])}break;case"color-palette":""!=s&&t(y).find(e).attr("data-value",s)}},repeater:function(e,i,a){if(t(a).find(".sb-icon-close").remove(),a=t(a).html(),"set"==e){var s="";if(i.length>0)for(var n=0;n<i.length;n++){let e=t.parseHTML(`<div>${a}</div>`);for(var o in i[n])this.setInput(t(e).find(`[data-id="${o}"]`),i[n][o]);s+=`<div class="repeater-item">${t(e).html()}<i class="sb-icon-close"></i></div>`}return s}if("get"==e){let e=[],a=this;return t(i).each(function(){let i={},s=!0;t(this).find("[data-id]").each(function(){let e=a.getInput(this);s&&""!=e&&"hidden"!=t(this).attr("type")&&"auto-id"!=t(this).attr("data-type")&&(s=!1),i[t(this).attr("data-id")]=e}),s||e.push(i)}),e}},repeaterAdd:function(e){let i=t(e).parent();e=t.parseHTML(`<div>${t(i).find(".repeater-item:last-child").html()}</div>`),t(e).find("[data-id]").each(function(){if(z.resetInput(this),"auto-id"==t(this).data("type")){let e=1;t(i).find('[data-type="auto-id"]').each(function(){let i=parseInt(t(this).val());i>e&&(e=i)}),t(this).attr("value",e+1)}}),t(i).find(".sb-repeater").append(`<div class="repeater-item">${t(e).html()}</div>`)},repeaterDelete:function(e){t(e).parent().parent().find(".repeater-item").length>1&&t(e).parent().remove()},setInput:function(e,i){if(i=t.trim(i),t(e).is("select"))t(e).find(`option[value="${i}"]`).attr("selected","");else if(t(e).is("checkbox")&&i)t(e).attr("checked","");else if(t(e).is("textarea"))t(e).html(i);else{let a=t(e).is("div");a||t(e).is("i")||t(e).is("li")?(t(e).attr("data-value",i),a&&t(e).hasClass("image")&&t(e).css("background-image",`url("${i}")`)):t(e).attr("value",i)}},getInput:function(e){if(t(e).is("checkbox"))return t(e).is(":checked");if(t(e).is("div")||t(e).is("i")||t(e).is("li")){let i=t(e).attr("data-value");return SBF.null(i)?"":i}return t(e).val()},resetInput:function(e){t(e).is("select")?t(e).val("").find("[selected]").removeAttr("selected"):t(e).is("checkbox")&&value?t(e).removeAttr("checked").prop("checked",!1):t(e).is("textarea")?t(e).html(""):t(e).removeAttr("value").removeAttr("data-value").val("")},articles:function(e=""){let i=t(y).find(".sb-articles-area"),a=t(i).find(".sb-content").attr("data-article-id");if("save"==e&&-1!=a)for(var s=0;s<D.length;s++)if(D[s].id==a){D[s]={id:a,title:t(i).find(".sb-article-title input").val(),content:t(i).find(".sb-article-content textarea").val(),link:t(i).find(".sb-article-link input").val()};break}}},J={real_time:null,datetime_last_user:"2000-01-01 00:00:00",sorting:["creation_time","DESC"],user_types:["visitor","lead","user"],search_query:"",init:!1,busy:!1,filter:function(t){t="all"==t?["visitor","lead","user"]:"agent"==t?["agent","admin"]:[t],this.user_types=t,this.loading(),R=1,SBF.ajax({function:"online"==t?"get-online-users":"get-users",exclude_id:SB_ACTIVE_AGENT.id,sorting:this.sorting,user_types:t,search:this.search_query},t=>{this.populate(t),this.loading(!1)})},sort:function(t,e="DESC"){this.sorting=[t,e],this.loading(),R=1,SBF.ajax({function:"get-users",sorting:this.sorting,user_types:this.user_types,search:this.search_query},t=>{this.populate(t),this.loading(!1)})},search:function(e){d(e,(e,i)=>{R=1,SBF.ajax({function:e.length>1?"search-users":"get-users",search:e,user_types:this.user_types,sorting:this.sorting},a=>{this.user_types=["visitor","lead","user"],this.populate(a),this.search_query=e,t(i).sbLoading(!1),t(S).find("li").sbActivate(!1).eq(0).sbActivate()})})},populate:function(e){let i="",a=e.length;if(a)for(var s=0;s<a;s++)i+=this.getRow(new SBUser(e[s]));else i=`<p class="sb-no-results">${o("No users found.")}</p>`;t(m).find("tbody").html(i)},update:function(){if(!this.busy){let e=["user","visitor","lead"].includes(this.user_types[0])&&""==this.search_query,i=t(S).find(".sb-active").data("type");"online"==i?this.filter(i):(this.busy=!0,SBF.ajax({function:"get-new-users",datetime:this.datetime_last_user},a=>{let s=a.length;if(this.busy=!1,s>0){let o="";for(var n=0;n<s;n++){let t=new SBUser(a[n]);M[t.id]=t,this.updateMenu("add",t.type),e&&(o+=this.getRow(t))}""!=o&&(t(m).find("tbody").prepend(o),""!=(i="user"==i?'[data-user-type="visitor"], [data-user-type="lead"]':"visitor"==i?'[data-user-type="user"], [data-user-type="lead"]':"")&&t(m).find(i).remove()),this.datetime_last_user=a[0].creation_time}}))}},getRow:function(t){return t instanceof SBUser?`<tr data-user-id="${t.id}" data-user-type="${t.type}"><td><input type="checkbox" /></td><td class="sb-td-profile"><a class="sb-profile"><img src="${t.image}" /><span>${t.get("full_name")}</span></a></td><td class="sb-td-email">${t.get("email")}</td><td class="sb-td-ut">${t.type}</td><td>${SBF.beautifyTime(t.get("last_activity"))}</td><td>${t.get("creation_time")}</td></tr>`:(SBF.error("User not of type SBUser","SBUsers.getRow"),!1)},updateRow:function(e){let i=t(m).find(`[data-user-id="${e.id}"]`);if(i.length){let a=t(S).find(".sb-active").data("type");if(e.type==a||"admin"==e.type&&"agent"==a||"all"==a)t(i).replaceWith(this.getRow(e));else{let a=t(p).find(`[data-type="${"admin"==e.type?"agent":e.type}"] span`),s=parseInt(t(a).attr("data-count"));t(a).html(s+1).attr("data-count",s+1),t(i).remove()}}else t(m).find("tbody").append(this.getRow(e))},updateMenu:function(t="all",e=!1){let i=["all","user","lead","visitor"];"all"==t?SBF.ajax({function:"count-users"},t=>{for(var e=0;e<i.length;e++)this.updateMenuItem(S,"set",i[e],t[i[e]])}):this.updateMenuItem(S,t,e)},updateMenuItem:function(e,i="set",a=!1,s=1){let n=t(e).find(`[data-type="${a}"] span`);if("set"!=i&&(s=parseInt(t(n).attr("data-count"))+1*("add"==i?1:-1)),"set"!=i&&"all"!=a){let a=t(e).find('[data-type="all"] span'),s=parseInt(t(a).attr("data-count"));s+=1*("add"==i?1:-1),t(a).html(`(${s})`).attr("data-count",s)}t(n).html(`(${s})`).attr("data-count",s)},delete:function(e){this.loading(),Array.isArray(e)?SBF.ajax({function:"delete-users",user_ids:e},()=>{for(var a=0;a<e.length;a++)delete M[e[a]],t(m).find(`[data-user-id="${e[a]}"]`).remove(),t(v).find(`[data-user-id="${e[a]}"]`).remove();0==t(m).find("[data-user-id]").length&&this.filter(t(S).find(".sb-active").data("type")),i("Users deleted"),this.updateMenu(),this.loading(!1)}):M[e].delete(()=>{a().id==e&&a(!1),delete M[e],t(m).find(`[data-user-id="${e}"]`).remove(),t(v).find(`[data-user-id="${e}"]`).remove(),t(p).sbHideLightbox(),i("User deleted"),this.updateMenu(),this.loading(!1)})},startRealTime:function(){this.stopRealTime(),this.real_time=setInterval(()=>{this.update()},1e3)},stopRealTime:function(){clearInterval(this.real_time)},loading:function(e=!0){let i=t(g).find(".sb-loading-table");e?t(i).sbActivate():t(i).sbActivate(!1)},csv:function(){SBF.ajax({function:"csv-users"},t=>window.open(t))}},X={real_time:null,datetime_last_conversation:"2000-01-01 00:00:00",user_typing:!1,desktop_notifications:!1,flash_notifications:!1,busy:!1,is_search:!1,open:function(e=-1,i){-1!=e&&this.openConversation(e,i),t(p).sbHideLightbox(),t(f).find(".sb-admin-nav a").sbActivate(!1).parent().find("#sb-messages").sbActivate(),t(p).find(" > main > div").sbActivate(!1),t(h).sbActivate().find(".sb-board").removeClass("sb-no-conversation"),this.startRealTime()},openConversation:function(i,s=!1,n=!0){if(!1===s)SBF.ajax({function:"get-conversation",conversation_id:i},t=>{this.openConversation(i,t.details.user_id,n)});else{let r=t(h).find(".sb-conversation .sb-list"),l=SBF.null(M[s]);t(r).html(""),t(r).sbLoading(!0),l?(a(new SBUser({id:s})),a().update(()=>{M[s]=a(),this.updateUserDetails()})):a(M[s]),t(v).find("li").sbActivate(!1),t(h).find(`[data-conversation-id="${i}"]`).sbActivate(),-1!=i?a().getFullConversation(i,e=>{let a=h.find(`[data-conversation-id="${i}"]`),s=e.get("conversation_status_code"),l=t(b).find(".sb-select");if(SBChat.setConversation(e),SBChat.populate(),t(h).find(".sb-top > a").html(e.get("title")),t(h).find('.sb-top [data-value="read"]').sbActivate(2==s),O){let i="department"in e.details&&!SBF.null(e.details.department)?e.details.department:-1,a=t(h).find("#conversation-department"),s=t(a).find(`[data-id="${i}"]`);t(a).find(" > p").attr("data-value",t(s).data("value")).html(t(s).html())}[1,2].includes(s)&&(s=0),t(l).find(".sb-active").attr("data-value")!=s&&(t(l).find(`[data-value="${s}"]`).click(),t(l).find("ul").sbActivate(!1)),j&&this.mobileOpenConversation(),t(a).sbActivate(),n&&this.scrollTo(),SBF.ajax({function:"is-agent-typing",conversation_id:i},e=>{SBF.null(e)||(t(h).find(".sb-editor > .sb-labels").prepend(`<span class="sb-status-warning sb-status-agent-typing">${e.first_name} ${e.last_name} ${o("is writing an answer...")}</span>`),setTimeout(()=>{t(h).find(".sb-status-agent-typing").remove()},5e3))}),W.is("woocommerce")&&W.woocommerce.conversationPanel(),W.is("ump")&&W.ump.conversationPanel(),setTimeout(()=>{t(a).find(" > span").remove()},3e3),t(r).sbLoading(!1)}):(SBChat.clear(),t(v).find("li").sbActivate(!1),t(r).sbLoading(!1)),l||this.updateUserDetails(),a().getConversations(function(e){t(h).find(".sb-user-conversations").html(a().getConversationsCode(e))}),t(h).find(".sb-board").removeClass("sb-no-conversation"),e(),this.startRealTime(),SBChat.email_sent=!1}},populate:function(t,e,i){this.openConversation(t,e,i)},populateList:function(e){let i="";T=[];for(var a=0;a<e.length;a++)i+=this.getListCode(e[a]),T.push(e[a]);""==i&&(i=`<p class="sb-no-results">${o("No conversations found.")}</p>`),t(v).html(i),this.updateMenu()},update:function(){this.busy||(this.busy=!0,SBF.ajax({function:"get-new-conversations",datetime:this.datetime_last_conversation,routing:SB_ADMIN_SETTINGS.routing},e=>{if(this.busy=!1,e.length){let s,n="",r="",l=0!=SBChat.conversation?SBChat.conversation.id:-1,c=!1,d=[];this.datetime_last_conversation=e[0].creation_time;for(var i=0;i<e.length;i++)if(!d.includes(e[i].conversation_id)){let u=e[i],p=u.conversation_status_code,f=u.user_id,b=u.conversation_id,g=l==b,m=this.getListCode(u,null,!g),S=t(v).find(`[data-conversation-id="${b}"]`),_=S.index(),x=S.length,y=SBF.null(e[i].payload)?{}:JSON.parse(e[i].payload);g?(m=m.replace("<li",'<li class="sb-active"'),x?(""!=u.message&&t(S).replaceWith(m),T[_].conversation_status_code=p,t(h).find('.sb-top [data-value="read"]').sbActivate(2==p)):c=!0):x&&(T[_]=u,t(v).find(`[data-conversation-id="${b}"]`).remove()),f in M||(M[f]=new SBUser({id:f,first_name:u.first_name,last_name:u.last_name,profile_image:u.profile_image,user_type:u.user_type})),g&&0!=x||(2==p?(n+=m,T.unshift(u)):0!=p&&1!=p||(0==(s=t(v).find('[data-conversation-status="2"]').last()).length?n+=m:(T.splice(s.index()+1,0,u),r+=m)),0==x&&["a","c","ic"].includes(SB_ADMIN_SETTINGS.sounds)&&SBChat.audio.play(),f==a().id&&a().getConversations(function(e){t(h).find(".sb-user-conversations").html(a().getConversationsCode(e))})),"event"in y&&"update-user"==y.event&&a().update(()=>{this.updateUserDetails()}),SBChat.tab_active||SBF.isAgent(u.message_user_type)&&"bot"!=u.message_user_type||(this.desktop_notifications&&SBChat.desktopNotification(u.first_name+" "+u.last_name,u.message,u.profile_image.indexOf("user.svg")>0?SB_ADMIN_SETTINGS["notifications-icon"]:u.profile_image,b,f),this.flash_notifications&&(document.title=o("New message..."))),d.push(b)}""!=n&&t(v).prepend(n),""!=r&&t(r).insertAfter(s),c&&this.scrollTo(),this.updateMenu()}}))},updateMenu:function(){t(b).find(".sb-select > p span").html("("+t(v).find('[data-conversation-status="2"]').length+")")},messageMenu:function(t){return`<i class="sb-menu-btn sb-icon-menu"></i><ul class="sb-menu">${SB_VERSIONS.dialogflow?`<li data-value="bot">${o("Send to Dialogflow")}</li>`:""}${t?`<li data-value="delete">${o("Delete")}</li>`:""}</ul>`},updateUserDetails(){a()&&(t(h).find(`[data-user-id="${a().id}"] .sb-name,.sb-top > a`).html(a().get("full_name")),t(h).find(".sb-user-details .sb-profile").setProfile(),Y.populate(a(),t(h).find(".sb-profile-list")))},getListCode:function(t,e,i=!1){let a=t.message;if(SBF.null(e)&&(e=t.conversation_status_code),a.length>110&&(a=a.substr(0,110)+" ..."),""==a&&!SBF.null(t.attachments)){let e=JSON.parse(t.attachments);if(Array.isArray(e)){for(var s=0;s<e.length;s++)a+=e[s][0]+" ";a.length>114&&(a=a.substr(0,114)+" ...")}}return`<li data-user-id="${t.user_id}" data-conversation-id="${t.conversation_id}" data-conversation-status="${e}">`+(i&&2==e?"<span>"+o("New")+"</span>":"")+`<div class="sb-profile"><img src="${t.profile_image}"><span class="sb-name">${t.first_name} ${t.last_name}</span><span class="sb-time">${SBF.beautifyTime(t.creation_time)}</span></div><p>${a}</p></li>`},startRealTime:function(){this.stopRealTime(),this.real_time=setInterval(()=>{this.update(),this.updateCurrentURL()},1e4),SBChat.startRealTime()},stopRealTime:function(){clearInterval(this.real_time),SBChat.stopRealTime()},csv:function(t=-1){SBF.ajax({function:"csv-conversations",conversation_id:t},t=>window.open(t))},typing:function(e){e?SBChat.user_online&&!this.user_typing&&(t(h).find(".sb-conversation .sb-top > .sb-labels").append('<span class="sb-status-typing">'+o("Typing")+"</span>"),this.user_typing=!0):this.user_typing&&(t(h).find(".sb-conversation .sb-top .sb-status-typing").remove(),this.user_typing=!1)},scrollTo:function(){let e=t(v).find(".sb-active"),i=e.length?t(e)[0].offsetTop:0;t(v).parent().scrollTop(i-(j?120:70))},search:function(e){d(e,(e,i)=>{e.length>1?SBF.ajax({function:"search-conversations",search:e,routing:SB_ADMIN_SETTINGS.routing},e=>{X.populateList(e),t(i).sbLoading(!1),this.scrollTo(),this.is_search=!0}):(N=1,SBF.ajax({function:"get-conversations",status_code:t(b).find(".sb-select li.sb-active").data("value"),routing:SB_ADMIN_SETTINGS.routing},e=>{X.populateList(e),t(i).sbLoading(!1),this.is_search=!1}))})},updateCurrentURL:function(){if(SBChat.user_online&&0!=a()){let e=t(h).find('.sb-profile-list [data-id="current_url"] label');e.length&&SBF.ajax({function:"current-url"},i=>{0!=i&&t(e).attr("data-value",i).html(i.replace("https://","").replace("http://","").replace(/\/$/,""))})}},showDialogflowIntent:function(e){let i=t(p).find(".sb-dialogflow-intent-box"),a=SBChat.conversation.messages,s="",n="";for(var o=a.length-1;o>0;o--)if(a[o].id==e){n=a[o].get("message"),SBF.isAgent(a[o].get("user_type"))?s=0==(s=SBChat.conversation.getLastUserMessage(o-1))?"":s.get("message"):(s=n,n="");break}t(i).find(".sb-type-text:not(.sb-first)").remove(),t(i).find("input").val(s),t(i).find("textarea").val(n),t(i).sbShowLightbox()},sendDialogflowIntent:function(e){if(!t(e).sbLoading()){t(e).sbLoading(!0);let a=t(p).find(".sb-dialogflow-intent-box"),s=[],n=t(a).find("textarea").val();t(a).find(".sb-type-text input").each(function(){""!=t(this).val()&&s.push(t(this).val())}),""==n||0==s.length?SBForm.showErrorMessage(a,"Please insert the bot response and at least one user expression."):SBF.ajax({function:"dialogflow-intent",expressions:s,response:n,agent_language:t(a).find(".sb-dialogflow-languages select").val()},s=>{if(!0===s)t(p).sbHideLightbox(),i("Intent created");else{let t="Error";"error"in s&&"message"in s.error&&(t=s.error.message),SBForm.showErrorMessage(a,t)}t(e).sbLoading(!1)})}},assignDepartment:function(t,e,i){SBF.ajax({function:"update-conversation-department",conversation_id:t,department:e,message:SBChat.conversation.getLastMessage().get("message")},t=>{i(t)})},mobileOpenConversation:function(){t(h).find(".sb-admin-list").sbActivate(!1),t(h).find(".sb-conversation").sbActivate(),t(f).addClass("sb-hide")},mobileCloseConversation:function(){t(v).find("li.sb-active").sbActivate(!1),t(h).find(".sb-admin-list").sbActivate(),t(h).find(".sb-conversation").sbActivate(!1),t(f).removeClass("sb-hide")},clickFirst:function(){t(v).find("li:first-child").click()},savedReplies(e,i){let a=i.charAt(e.selectionStart-1);if("#"==a&&(SBChat.editor_listening=!0),SBChat.editor_listening&&" "==a){let a=i.substr(i.lastIndexOf("#")+1).replace(" ","");SBChat.editor_listening=!1;for(var s=0;s<L.length;s++)if(L[s]["reply-name"]==a)return void t(e).val(i.substr(0,i.lastIndexOf("#"))+L[s]["reply-text"])}}},Y={getAll:function(t){return SBForm.getAll(t)},get:function(t){return SBForm.get(t)},set:function(t,e){return SBForm.set(t,e)},show:function(e){n(),a(new SBUser({id:e})),a().update(()=>{this.populate(a(),t(_).find(".sb-profile-list")),t(_).find(".sb-profile").setProfile(),a().getConversations(e=>{let i=a().type;SBF.isAgent(i)&&this.agentData(),t(_).find(".sb-user-conversations").html(a().getConversationsCode(e)),this.boxClasses(_,i),t(_).attr("data-user-id",a().id).sbShowLightbox(),n(!1,!1)}),M[e]=a()})},showEdit:function(e){if(!(e instanceof SBUser))return SBF.error("User not of type SBUser","SBUsers.showEdit"),!1;{let i=t(x).find("#password input"),a=e.type,s=t(x).find("#user_type select"),n=t(x).find("#email input");t(x).removeClass("sb-user-new").attr("data-user-id",e.id),t(x).find(".sb-top-bar .sb-save").html(`<i class="sb-icon-check"></i>${o("Save changes")}`),t(x).find(".sb-profile").setProfile(),this.populateEdit(e,x),"visitor"==a||"lead"==a?t(n).removeAttr("required"):t(n).prop("required",!0),"admin"==SB_ACTIVE_AGENT.user_type&&SBF.isAgent(a)&&t(s).html('<option value="agent">Agent</option><option value="admin"'+("admin"==a?" selected":"")+">Admin</option>"),""!=t(i).val()&&t(i).val("********"),this.boxClasses(x,a),t(x).sbShowLightbox()}},populate:function(e,i){let a=["first_name","last_name","password","profile_image"],s=t(i).hasClass("sb-profile-list-conversation")?this.profileRow("conversation-id",t(v).find(".sb-active").attr("data-conversation-id"),o("Conversation ID")):"";"admin"!=SB_ACTIVE_AGENT.user_type&&a.push("token");for(var n in e.details)a.includes(n)||(s+=this.profileRow(n,e.get(n)));if(e.isExtraEmpty())SBF.ajax({function:"get-user-extra",user_id:e.id},a=>{for(var n=0;n<a.length;n++){let t=a[n].slug;e.setExtra(t,a[n]),s+=this.profileRow(t,a[n].value,a[n].name)}t(i).html(`<ul>${s}</ul>`),c(i,145)});else{for(var n in e.extra){let t=e.getExtra(n);s+=this.profileRow(n,t.value,t.name)}t(i).html(`<ul>${s}</ul>`),c(i,145)}},profileRow:function(t,e,i=t){if(""==e)return"";let a,s={id:"padlock","conversation-id":"padlock",full_name:"user",email:"envelope",phone:"phone",user_type:"user",last_activity:"calendar",creation_time:"calendar",token:"shuffle",currency:"currency",browser:"smartphone",ip:"internet",location:"marker",country:"marker",address:"marker",city:"marker",os:"desktop",current_url:"next",timezone:"clock"},n=`<i class="sb-icon sb-icon-${t in s?s[t]:"plane"}"></i>`,r=!1;switch(t){case"last_activity":case"creation_time":e=SBF.beautifyTime(e);break;case"user_type":e=SBF.slugToString(e);break;case"country_code":case"browser_language":n=`<img src="${SB_URL}/media/flags/${e.toLowerCase()}.png" />`;break;case"browser":(a=e.toLowerCase()).indexOf("chrome")>-1?r="chrome":a.indexOf("edge")>-1?r="edge":a.indexOf("firefox")>-1?r="firefox":a.indexOf("opera")>-1?r="opera":a.indexOf("safari")>-1&&(r="safari"),r&&(n=`<img src="${SB_URL}/media/devices/${r}.svg" />`);break;case"os":(a=e.toLowerCase()).indexOf("windows")>-1?r="windows":a.indexOf("mac")>-1||a.indexOf("apple")>-1||a.indexOf("ipad")>-1||a.indexOf("iphone")>-1?r="apple":a.indexOf("android")>-1&&(r="android"),r&&(n=`<img src="${SB_URL}/media/devices/${r}.svg" />`)}return`<li data-id="${t}">${n}<span>${o(SBF.slugToString(i))}</span><label>${e}</label></li>`},populateEdit:function(e,i){t(i).find(".sb-details .sb-input").each((i,a)=>{this.set(a,e.details[t(a).attr("id")])}),t(i).find(".sb-additional-details .sb-input").each((i,a)=>{let s=t(a).attr("id");s in e.extra?this.set(a,e.extra[s].value):this.set(a,"")})},clear:function(t){SBForm.clear(t)},errors:function(e){return SBForm.errors(t(e).find(".sb-details"))},showErrorMessage:function(t,e){SBForm.showErrorMessage(t,e)},agentData:function(){let e=`<div class="sb-title">${o("Feedback rating")}</div><div class="sb-rating-area sb-loading"></div>`,i=t(_).find(".sb-agent-area");t(i).html(e),SBF.ajax({function:"get-rating"},a=>{if(0==a[0]&&0==a[1])e=`<p class="sb-no-results">${o("No ratings yet.")}</p>`;else{let t=a[0]+a[1],i=100*a[0]/t,s=100*a[1]/t;e=`<div><div>${o("Positive")}</div><span data-count="${a[0]}" style="width: ${Math.round(2*i)}px"></span><div>${i.toFixed(2)} %</div></div><div><div>${o("Negative")}</div><span data-count="${a[1]}" style="width: ${Math.round(2*s)}px"></span><div>${s.toFixed(2)} %</div></div><p class="sb-rating-count">${t} ${o("Ratings")}</p>`}t(i).find(".sb-rating-area").html(e).sbLoading(!1)})},boxClasses:function(e,i=!1){t(e).removeClass("sb-type-admin sb-type-agent sb-type-lead sb-type-user sb-type-visitor").addClass(`${0!=i?`sb-type-${i}`:""} sb-agent-${SB_ACTIVE_AGENT.user_type}`)}},Q={conversations:X,users:J,settings:z,profile:Y};window.SBAdmin=Q,t(document).ready(function(){if(p=t(".sb-admin"),f=t(p).find("> .sb-header"),h=t(p).find(".sb-area-conversations"),b=t(h).find(".sb-admin-list"),v=t(b).find(".sb-scroll-area ul"),g=t(p).find(".sb-area-users"),m=t(g).find(".sb-table-users"),S=t(g).find(".sb-menu-users"),_=t(p).find(".sb-profile-box"),x=t(p).find(".sb-profile-edit-box"),y=t(p).find(".sb-area-settings"),O=t(h).find("#conversation-department").length,F=t(h).find(".sb-replies"),$=t(p).find(".sb-lightbox-overlay"),C="undefined"!=typeof SB_URL?SB_URL.substr(0,SB_URL.indexOf("-content")-3):"",I=t(h).find(".sb-woocommerce-products"),E=t(I).find(" > div > ul"),p.length&&(t(p).removeAttr("style"),(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"))&&t(p).addClass("sb-pwa"),W.is("woocommerce")&&(I=t(h).find(".sb-woocommerce-products"),E=t(I).find(" > div > ul")),P&&r(),!t(p).find(" > .sb-rich-login").length))if("undefined"!=typeof SB_ADMIN_SETTINGS)t(window).keydown(function(e){let i=e.which,s=!1;if([13,27,37,38,39,40,46].includes(i)){if(t(p).find(".sb-dialog-box").sbActive()){let e=t(p).find(".sb-dialog-box");switch(i){case 46:case 27:t(e).find(".sb-cancel").click();break;case 13:t(e).find("info"!=t(e).attr("data-type")?".sb-confirm":".sb-close").click()}s=!0}else if([38,40,46].includes(i)&&t(h).sbActive()){if(46==i){let e=t(h).find(" > div > .sb-conversation");t(e).find('.sb-top [data-value="'+(3==t(e).attr("data-conversation-status")?"delete":"archive")+'"]').click()}else if(e.ctrlKey){let e=t(v).find(".sb-active");40==i?t(e).next().click():t(e).prev().click(),X.scrollTo()}s=!0}else if([37,39].includes(i)&&t(g).sbActive()&&t(p).find(".sb-lightbox").sbActive()){let e=t(m).find(`[data-user-id="${a().id}"]`);e=39==i?t(e).next():t(e).prev(),t(e).length&&(t(p).sbHideLightbox(),Y.show(t(e).attr("data-user-id"))),s=!0}else[46,27].includes(i)&&t(p).find(".sb-lightbox").sbActive()&&(t(p).sbHideLightbox(),s=!0);s&&e.preventDefault()}}),l(),t(document).on("click keydown mousemove",function(){SBChat.tab_active||SBF.visibilityChange(),SBChat.tab_active=!0,V[1]&&(V[1]=!1,l(),setTimeout(function(){V[1]=!0},1e3))}),t(f).on("click",".sb-version",function(){let e=t(p).find(".sb-updates-box");SBF.ajax({function:"get-versions"},i=>{let a="",s={sb:"Support Board",slack:"Slack",dialogflow:"Dialogflow",tickets:"Tickets",woocommerce:"Woocommerce",ump:"Ultimate Membership Pro"},r=!1;for(var l in i)if(W.is(l)){let t=SB_VERSIONS[l]==i[l];t||(r=!0),a+=`<div class="sb-input"><span>${s[l]}</span><div${t?' class="sb-green"':""}>${o(t?"You are running the latest version.":"Update available! Please update now.")} ${o("Your version is")} V ${SB_VERSIONS[l]}.</div></div>`}r?t(e).find(".sb-update").removeClass("sb-hide"):t(e).find(".sb-update").addClass("sb-hide"),n(!1),t(e).find(".sb-main").prepend(a),t(e).sbShowLightbox()}),n(!0),t(e).sbActivate(!1),t(e).find(".sb-input").remove()}),t(p).on("click",".sb-updates-box .sb-update",function(){let e=t(p).find(".sb-updates-box");t(this).sbLoading()||(SBF.ajax({function:"update"},i=>{let a="";if(SBF.errorValidation(i,"envato-purchase-code-not-found"))a="Please go to Settings > Miscellaneous and insert your Envato Purchase Code.";else if(Array.isArray(i)&&!i.length)a="Invalid Envato Purchase Code.";else{let t=!0;for(var s in i)if("success"!=i[s]){t=!1;break}t||(a=JSON.stringify(i))}""==a?(r(),location.reload()):SBForm.showErrorMessage(e,a),t(this).sbLoading(!1)}),t(this).sbLoading(!0))}),setTimeout(function(){if(SB_ADMIN_SETTINGS["auto-updates"]){let t=SBF.storage("last-update-check"),e=[U.getMonth(),U.getDate()];(0==t||e[0]!=t[0]||e[1]>t[1]+10)&&(SBF.storage("last-update-check",e),SBF.ajax({function:"update"},t=>{"string"==typeof t||Array.isArray(t)||(i("Automatic update complete. Reload the admin area to apply the update."),r())}))}},1e3),t(p).on("click",".sb-apps > div",function(){let e=t(p).find(".sb-app-box"),i=t(this).data("app"),a="?utm_source=plugin&utm_medium=admin_area&utm_campaign=plugin";SBF.ajax({function:"app-get-key",app_name:i},i=>{t(e).find("input").val(i)}),t(e).find("input").val(""),t(e).find(".sb-top-bar > div:first-child").html(t(this).find("h2").html()),t(e).find("p").html(t(this).find("p").html()),t(e).attr("data-app",i),t(e).find(".sb-btn-app-puchase").attr("href","https://board.support/shop/"+i+a),t(e).find(".sb-btn-app-details").attr("href","https://board.support/"+i+a),t(e).sbShowLightbox()}),t(p).on("click",".sb-app-box .sb-activate",function(){let e=t(p).find(".sb-app-box"),a=t(e).find("input").val();""!=a?t(this).sbLoading()||(SBF.ajax({function:"app-activation",app_name:t(e).attr("data-app"),key:a},a=>{if(SBF.errorValidation(a)){let i="";i="invalid-key"==(a=a[1])?"It looks like your license key is invalid. If you believe this is an error, please contact support.":"expired"==a?"Your license key is expired. Please purchase a new license. If you believe this is an error, please contact support.":"Error: "+a,SBForm.showErrorMessage(e,i),t(this).sbLoading(!1)}else i("Activation complete! Page reload in progress..."),setTimeout(function(){location.reload()},1e3)}),t(this).sbLoading(!0)):SBForm.showErrorMessage(e,"Please insert the license key.")}),"undefined"==typeof Notification||"all"!=SB_ADMIN_SETTINGS["desktop-notifications"]&&"agents"!=SB_ADMIN_SETTINGS["desktop-notifications"]||SB_ADMIN_SETTINGS["push-notifications"]||(X.desktop_notifications=!0),"all"!=SB_ADMIN_SETTINGS["flash-notifications"]&&"agents"!=SB_ADMIN_SETTINGS["flash-notifications"]||(X.flash_notifications=!0),U.getDate()!=SBF.storage("admin-clean")&&setTimeout(function(){SBF.ajax({function:"cron-jobs"}),SBF.storage("admin-clean",U.getDate())},1e4),t(p).on("click",".sb-collapse-btn",function(){let e=t(this).sbActive(),i=e?t(this).parent().data("height")+"px":"";t(this).html(o(e?"View more":"Close")),t(this).parent().find(" > div, > ul").css({height:i,"max-height":i}),t(this).sbActivate(!e)}),t(p).on("click",".sb-popup-close",function(){t(p).sbHideLightbox(!0)}),j&&(t(p).on("click",".sb-menu-mobile > i",function(){t(this).toggleClass("sb-active")}),t(p).on("click",".sb-menu-mobile a",function(){t(this).closest(".sb-menu-mobile").find(" > i").sbActivate(!1)}),t(p).on("click",".sb-menu-wide,.sb-nav",function(){t(this).toggleClass("sb-active")}),t(p).on("click",".sb-menu-wide > ul > li, .sb-nav > ul > li",function(e){let i=t(this).parent().parent();return t(i).find("li").sbActivate(!1),t(i).find("> div").html(t(this).html()),t(i).sbActivate(!1),e.preventDefault(),!1}),t(p).find(".sb-admin-list .sb-scroll-area, main > div > .sb-scroll-area,.sb-area-settings > .sb-tab > .sb-scroll-area").on("scroll",function(){let e=t(this).scrollTop();G.last<e-10&&G.header?(t(p).addClass("sb-header-hidden"),G.header=!1):G.last>e+10&&!G.header&&!G.always_hidden&&(t(p).removeClass("sb-header-hidden"),G.header=!0),G.last=e}),t(p).on("click",".sb-search-btn i",function(){t(this).parent().sbActive()?(t(p).addClass("sb-header-hidden"),G.always_hidden=!0):(G.always_hidden=!1,t(v).parent().scrollTop()<10&&t(p).removeClass("sb-header-hidden"))}),t(h).on("click",".sb-top .sb-btn-back",function(){X.mobileCloseConversation()}),t(m).find("th:first-child").html(o("Order by")),t(m).on("click","th:first-child",function(){t(this).parent().toggleClass("sb-active")})),t(f).on("click"," .sb-admin-nav a",function(){let e=t(this).attr("id");t(f).find(".sb-admin-nav a").sbActivate(!1),t(p).find(" > main > div").sbActivate(!1).eq(t(this).index()).sbActivate(),t(this).sbActivate(),SBF.deactivateAll(),"sb-messages"==e?(j||X.clickFirst(),X.update(),X.startRealTime(),J.stopRealTime()):"sb-users"==e?(J.startRealTime(),X.stopRealTime(),J.init||(n(),R=1,SBF.ajax({function:"get-users",user_types:["user","visitor","lead"]},t=>{J.populate(t),J.updateMenu(),J.init=!0,J.datetime_last_user=SBF.dateDB("now"),n(!1)}))):"sb-settings"==e&&(z.init||(n(),SBF.ajax({function:"get-all-settings"},t=>{z.initHTML(t);for(var e in t)z.set(e,t[e]);z.initPlugins(),z.init=!0,n(!1)})),J.stopRealTime(),X.stopRealTime())}),t(f).on("click",".sb-profile",function(){t(this).next().toggleClass("sb-active")}),t(f).on("click",'[data-value="logout"],.logout',function(){J.stopRealTime(),X.stopRealTime(),SBF.logout()}),t(f).on("click",'[data-value="edit-profile"],.edit-profile',function(){n();let e=new SBUser({id:SB_ACTIVE_AGENT.id});e.update(()=>{a(e),t(h).find(".sb-board").addClass("sb-no-conversation"),t(v).find(".sb-active").sbActivate(!1),Y.showEdit(e)})}),t(f).on("click",'[data-value="status"]',function(){q=!t(this).hasClass("sb-online"),t(this).html(o(q?"Online":"Offline")).attr("class",q?"sb-online":"sb-offline")}),t(f).find(".sb-account").setProfile(SB_ACTIVE_AGENT.full_name,SB_ACTIVE_AGENT.profile_image),setInterval(function(){e()},1e4),n(),SBF.ajax({function:"get-conversations",routing:SB_ADMIN_SETTINGS.routing},e=>{0==e.length&&t(h).find(".sb-board").addClass("sb-no-conversation"),X.populateList(e),j&&t(h).find(".sb-admin-list").sbActivate(),SBF.getURL("conversation")?X.openConversation(SBF.getURL("conversation")):j||X.clickFirst(),X.startRealTime(),X.datetime_last_conversation=SBF.dateDB("now"),n(!1)}),t(v).on("click","li",function(){X.openConversation(t(this).attr("data-conversation-id"),t(this).attr("data-user-id"),!1),SBF.deactivateAll()}),t(p).on("click",".sb-user-conversations li",function(){X.openConversation(t(this).attr("data-conversation-id"),a().id,t(this).attr("data-conversation-status")),SBF.deactivateAll()}),t(h).on("click",".sb-top ul a",function(){let e=-1,i="The conversation will be ",a=t(this).attr("data-value"),n=SBChat.conversation.id;switch(a){case"inbox":e=0,i+="restored.";break;case"archive":i+="archived.",e=3;break;case"delete":i+="deleted.",e=4;break;case"empty-trash":e=5,i="ALL conversations in the trash (including their messages) will be deleted permanently.";break;case"csv":X.csv(n);break;case"read":e=0,i+="marked as read."}-1!=e&&s(i,"alert",function(){SBF.ajax({function:"update-conversation-status",conversation_id:n,status_code:e},()=>{if([0,3,4].includes(e))for(var i=0;i<T.length;i++)if(T[i].conversation_id==n){T[i].conversation_status_code=e;break}"read"==a?(t(v).find(".sb-active").attr("data-conversation-status",0),t(h).find('.sb-top [data-value="read"]').sbActivate(!1)):(t(b).find(".sb-select li.sb-active").click(),t(b).find(".sb-select ul").sbActivate(!1)),SB_ADMIN_SETTINGS["close-message"]&&3==e&&SBF.ajax({function:"close-message",bot_id:SB_ADMIN_SETTINGS["bot-id"],conversation_id:n})})})}),SBF.ajax({function:"saved-replies"},e=>{let i=`<p class="sb-no-results">${o("No saved replies found. Add new saved replies via Settings > Miscellaneous.")}</p>`;if(Array.isArray(e)&&e.length>0&&""!=e[0]["reply-name"]){i="",L=e;for(var a=0;a<e.length;a++)i+=`<li><div>${e[a]["reply-name"]}</div><div>${e[a]["reply-text"]}</div></li>`}t(F).find(".sb-replies-list > ul").html(i).sbLoading(!1)}),t(h).on("click",".sb-btn-saved-replies",function(){t(F).sbTogglePopup(this)}),t(F).on("click",".sb-replies-list li",function(){SBChat.insertText(t(this).find("div:last-child").html()),SBF.deactivateAll(),t(p).removeClass("sb-popup-active")}),t(F).on("input",".sb-search-btn input",function(){let e=t(this).val();SBF.search(e,()=>{let i="",a=!(e.length>1);for(var s=0;s<L.length;s++)(a||L[s]["reply-name"].toLowerCase().indexOf(e)>-1||L[s]["reply-text"].toLowerCase().indexOf(e)>-1)&&(i+=`<li><div>${L[s]["reply-name"]}</div><div>${L[s]["reply-text"]}</div></li>`);t(F).find(".sb-replies-list > ul").html(i)})}),t(b).find(".sb-scroll-area").on("scroll",function(){if(!H&&!X.is_search&&u(this,!0)){let e=t(h).find(".sb-admin-list");H=!0,t(e).append('<div class="sb-loading-global sb-loading"></div>'),SBF.ajax({function:"get-conversations",pagination:N,status_code:t(e).find(" > .sb-top > .sb-select p").attr("data-value"),routing:SB_ADMIN_SETTINGS.routing},i=>{let a="";H=!1;for(var s=0;s<i.length;s++)a+=X.getListCode(i[s]),T.push(i[s]);N++,t(v).append(a),t(e).find(" > .sb-loading").remove(),u(this)})}}),t(document).on("SBMessageDeleted",function(){let e=SBChat.conversation.getLastMessage();0!=e?t(v).find("li.sb-active p").html(e.get("message")):(t(v).find("li.sb-active").remove(),X.clickFirst(),X.scrollTo())}),t(document).on("SBMessageSent",function(e,i){let a=t(v).find(`[data-conversation-id="${i.conversation_id}"]`);""!=i.message&&t(a).find("p").html(i.message),-1!=i.conversation_status_code&&(t(a).attr("data-conversation-status",i.conversation_status_code),X.updateMenu())}),t(document).on("SBNewMessagesReceived",function(e,i){setTimeout(function(){t(h).find(".sb-conversation .sb-top .sb-status-typing").remove()},300),X.update()}),t(document).on("SBNewConversationCreated",function(){X.update()}),t(document).on("SBEmailSent",function(){i("A notificaton email has been sent to the user.")}),t(document).on("SBTyping",function(t,e){X.typing(e)}),t(b).on("input",".sb-search-btn input",function(){X.search(this)}),t(h).on("click",".sb-admin-list .sb-search-btn i",function(){SBF.searchClear(this,()=>{X.search(t(this).next())})}),t(h).on("click",".sb-admin-list .sb-select li",function(){let e=t(v).parent(),i=t(this).data("value");t(e).sbLoading()||(N=1,t(e).sbLoading(!0),SBF.ajax({function:"get-conversations",status_code:i,routing:SB_ADMIN_SETTINGS.routing},a=>{if(X.populateList(a),t(h).find(".sb-conversation").attr("data-conversation-status",i),a.length){if(!j){let e=!0;if(0!=SBChat.conversation){let i=t(v).find(`[data-conversation-id="${SBChat.conversation.id}"]`);i.length&&(t(i).sbActivate(),e=!1)}e&&X.clickFirst(),X.scrollTo()}}else t(h).find(".sb-board").addClass("sb-no-conversation"),SBChat.conversation=!1;t(e).sbLoading(!1)}))}),t(h).on("click",".sb-user-details .sb-scroll-area > .sb-profile,.sb-top > a",function(){let e=t(v).find(".sb-active").attr("data-user-id");a().id!=e&&a(M[e]),Y.show(a().id)}),t(p).on("click",'.sb-profile-list [data-id="location"]',function(){s('<iframe src="https://maps.google.com/maps?q='+t(this).find("label").html().replace(", ","+")+'&output=embed"></iframe>',"map")}),t(p).on("click",'.sb-profile-list [data-id="timezone"]',function(){SBF.getLocationTimeString(a().extra,t=>{n(!1),s(t,"info")})}),t(p).on("click",'.sb-profile-list [data-id="current_url"]',function(){let e=t(this).find("label");window.open(SBF.null(t(e).attr("data-value"))?t(e).html():t(e).attr("data-value"))}),t(h).on("click",'.sb-menu [data-value="bot"]',function(){X.showDialogflowIntent(t(this).closest("[data-id]").attr("data-id"))}),t(p).on("click",".sb-dialogflow-intent-box .sb-intent-add i",function(){t(p).find(".sb-dialogflow-intent-box .sb-type-text").last().after('<div class="sb-input-setting sb-type-text"><input type="text"></div>')}),t(p).on("click",".sb-dialogflow-intent-box .sb-send",function(){X.sendDialogflowIntent(this)}),t(h).on("click","#conversation-department li",function(e){let a=t(this).parent().parent();return t(this).data("value")==t(a).find(" > p").attr("data-value")||(0==SBChat.conversation?(t(this).parent().sbActivate(!1),e.preventDefault(),!1):(t(a).sbLoading()||s(`All agents assigned to the new department will be notified via email. The new department will be ${t(this).html()}.`,"alert",()=>{t(a).sbLoading(!0),X.assignDepartment(SBChat.conversation.id,t(this).data("id"),()=>{i("Department updated. The agents have been notified via email."),t(a).find(" > p").attr("data-value",t(this).data("value")).html(t(this).html()).next().sbActivate(!1),""!=SB_ACTIVE_AGENT.department&&SB_ACTIVE_AGENT.department!=t(this).data("id")&&(t(v).find(`[data-conversation-id="${SBChat.conversation.id}"]`).remove(),X.clickFirst()),t(a).sbLoading(!1)})}),e.preventDefault(),!1))}),t(m).on("click","th :checkbox",function(){t(m).find("td :checkbox").prop("checked",t(this).prop("checked"))}),t(m).on("click",":checkbox",function(){let e=t(g).find('[data-value="delete"]');t(m).find("td input:checked").length?t(e).removeAttr("style"):t(e).hide()}),t(S).on("click","li",function(){J.filter(t(this).data("type"))}),t(g).on("input",".sb-search-btn input",function(){J.search(this)}),t(g).on("click",".sb-search-btn i",function(){SBF.searchClear(this,()=>{J.search(t(this).next())})}),t(m).on("click","th:not(:first-child)",function(){let e=t(this).hasClass("sb-order-asc")?"DESC":"ASC";t(this).toggleClass("sb-order-asc"),t(this).siblings().sbActivate(!1),t(this).sbActivate(!0),J.sort(t(this).data("field"),e)}),t(m).parent().on("scroll",function(){!H&&""==J.search_query&&u(this,!0)&&(H=!0,t(g).append('<div class="sb-loading-global sb-loading sb-loading-pagination"></div>'),SBF.ajax({function:"get-users",pagination:R,sorting:J.sorting,user_types:J.user_types,search:J.search_query},e=>{let i="";H=!1,R++;for(var a=0;a<e.length;a++){let t=new SBUser(e[a]);i+=J.getRow(t),M[t.id]=t}t(m).find("tbody").append(i),t(g).find(" > .sb-loading-pagination").remove(),u(this)}))}),t(g).on("click",'[data-value="csv"]',function(){J.csv()}),t(x).on("click",".sb-delete",function(){s("This user will be deleted permanently including all linked data, conversations, and messages.","alert",function(){J.delete(a().id)})}),t(g).on("click",'[data-value="delete"]',function(){s("All selected users will be deleted permanently including all linked data, conversations, and messages.","alert",()=>{let e=[];t(m).find("tr").each(function(){t(this).find('td input[type="checkbox"]').is(":checked")&&e.push(t(this).attr("data-user-id"))}),J.delete(e),t(this).hide(),t(m).find("th:first-child input").prop("checked",!1)})}),t(m).on("click","td:not(:first-child)",function(){Y.show(t(this).parent().attr("data-user-id"))}),t(_).on("click",".sb-top-bar .sb-edit",function(){Y.showEdit(a())}),t(g).on("click",".sb-new-user",function(){t(x).addClass("sb-user-new"),t(x).find(".sb-top-bar .sb-profile span").html(o("Add new user")),t(x).find(".sb-top-bar .sb-save").html(`<i class="sb-icon-check"></i>${o("Add user")}`),t(x).find("#email input").prop("required",!0),"admin"==SB_ACTIVE_AGENT.user_type&&t(x).find("#user_type").find("select").html('<option value="user">User</option><option value="agent">Agent</option><option value="admin">Admin</option>'),Y.clear(x),Y.boxClasses(x),t(x).sbShowLightbox()}),t(x).on("click",".sb-save",function(){let e=!!t(x).hasClass("sb-user-new"),s=t(x).attr("data-user-id");if(!t(this).sbLoading()){t(this).sbLoading(!0);let n=Y.getAll(t(x).find(".sb-details")),o=Y.getAll(t(x).find(".sb-additional-details"));if(Y.errors(x))return Y.showErrorMessage(x,["user","agent","admin"].includes(t(x).find("#user_type :selected").val())?"First name, last name, and a valid email are required.":"First name and last name are required."),void t(this).sbLoading(!1);SBF.ajax({function:e?"add-user":"update-user",user_id:s,settings:n,settings_extra:o},n=>{if(SBF.errorValidation(n,"duplicate-email"))return Y.showErrorMessage(x,"This email is already in use."),void t(this).sbLoading(!1);e&&(s=n,a(new SBUser({id:s}))),a().update(()=>{M[s]=a(),e?(Y.clear(x),J.update()):(J.updateRow(a()),t(h).sbActive()&&X.updateUserDetails(),s==SB_ACTIVE_AGENT.id&&(SBF.loginCookie(n[1]),SB_ACTIVE_AGENT.full_name=a().name,SB_ACTIVE_AGENT.profile_image=a().image,t(f).find(".sb-account").setProfile())),t(this).sbLoading(!1),t(x).find(".sb-profile").setProfile(),i(e?"New user added":"User updated")}),SBF.event("SBUserUpdated",{new_user:e,user_id:s})})}}),t(x).on("change","#user_type",function(){Y.boxClasses(x,t(this).find("option:selected").val())}),t(_).on("click",".sb-user-conversations li",function(){X.open(t(this).attr("data-conversation-id"),a().id)}),t(_).on("click",".sb-start-conversation",function(){X.open(-1,a().id),X.openConversation(-1,a().id)}),t(y).on("click",'[data-type="upload-image"] .image',function(){k=this,t(p).find(".sb-upload-form-admin .sb-upload-files").click()}),t(y).on("click",'[data-type="upload-image"] .image > i',function(e){return t(this).parent().removeAttr("data-value").css("background-image",""),e.preventDefault(),!1}),t(y).on("click",".sb-repeater-add",function(){z.repeaterAdd(this)}),t(y).on("click",".repeater-item > i",function(){z.repeaterDelete(this)}),t(y).find(".sb-type-color input").colorPicker({renderCallback:function(e,i){t(e.context).closest(".input").find("input").css("background-color",e.text)}}),t(y).find('[data-save="color"]').focusout(function(){let e=t(this).closest(".input-color"),i=t(e).find("input").val();setTimeout(function(){t(e).find("input").val(""),t(e).find(".color-preview").css("background-color",i)},300),z.set(t(this).attr("id"),i)}),t(y).on("click",".sb-type-color .input i",function(e){t(this).parent().find("input").removeAttr("style").val("")}),t(y).on("click",".sb-color-palette span",function(){let e=t(this).hasClass("sb-active");t(this).closest(".sb-repeater").find(".sb-active").sbActivate(!1),t(this).sbActivate(!e)}),t(y).on("click",".sb-color-palette ul li",function(){t(this).parent().parent().attr("data-value",t(this).data("value")).find("span").sbActivate(!1)}),t(y).on("click",".sb-save-changes",function(){z.save(this)}),t(y).on("change",'#user-additional-fields [data-id="extra-field-slug"], #saved-replies [data-id="reply-name"], [data-id="rich-message-name"]',function(){t(this).val(SBF.stringToSlug(t(this).val()))}),t(y).on("click","#timetable-utc input",function(){""==t(this).val()&&t(this).val(Math.round(U.getTimezoneOffset()/60))}),t(y).find("#dialogflow-button .sb-btn").attr("href","https://board.support/synch/?service=dialogflow&plugin_url="+SB_URL),t(y).on("click","#test-email-user .sb-btn, #test-email-agent .sb-btn",function(){let e=t(this).parent().find("input").val();""!=e&&e.indexOf("@")>0&&!t(this).sbLoading()&&(t(this).sbLoading(!0),SBF.ajax({function:"send-test-email",to:e,email_type:"test-email-user"==t(this).parent().parent().attr("id")?"user":"agent"},()=>{s("Email successfully sent. Check your emails!","info"),t(this).sbLoading(!1)}))}),t(y).on("click",".sb-timetable > div > div > div",function(){let e=t(this).closest(".sb-timetable"),i=t(this).sbActive();if(t(e).find(".sb-active").sbActivate(!1),i)t(this).sbActivate(!1).find(".sb-custom-select").remove();else{let i=t(e).find("> .sb-custom-select").html();t(e).find(" > div .sb-custom-select").remove(),t(this).append(`<div class="sb-custom-select">${i}</div>`).sbActivate(!0)}}),t(y).on("click",".sb-timetable .sb-custom-select span",function(){let e=[t(this).html(),t(this).attr("data-value")];t(this).closest(".sb-timetable").find("> div > div > .sb-active").html(e[0]).attr("data-value",e[1]),t(this).parent().sbActivate(!1)}),t(y).on("click","#system-requirements a",function(e){let i=t(p).find(".sb-requirements-box"),a="";return SBF.ajax({function:"system-requirements"},e=>{for(var s in e)a+=`<div class="sb-input"><span>${o(SBF.slugToString(s))}</span><div${e[s]?' class="sb-green"':""}>${o(e[s]?"Success":"Error")}</div></div>`;n(!1),t(i).find(".sb-main").html(a),t(i).sbShowLightbox()}),t(i).sbActivate(!1),n(!0),e.preventDefault(),!1}),t(y).on("click","#delete-leads a",function(e){return t(this).sbLoading()||s("All leads, including all the linked conversations and messages, will be deleted permanently.","alert",()=>{t(this).sbLoading(!0),SBF.ajax({function:"delete-leads"},()=>{s("Leads and conversations successfully deleted.","info"),t(this).sbLoading(!1)})}),e.preventDefault(),!1}),t(y).find("#slack-button .sb-btn").attr("href","https://board.support/synch/?service=slack&plugin_url="+SB_URL),t(y).on("click","#slack-test .sb-btn",function(e){return t(this).sbLoading()||(t(this).sbLoading(!0),SBF.ajax({function:"send-slack-message",user_id:-1,full_name:SB_ACTIVE_AGENT.full_name,profile_image:SB_ACTIVE_AGENT.profile_image,message:"Lorem ipsum dolor sit amete consectetur adipiscing elite incidido labore et dolore magna aliqua.",attachments:[["Example link",SB_URL+"/media/user.svg"],["Example link two",SB_URL+"/media/user.svg"]]},e=>{SBF.errorValidation(e)?"slack-not-active"==e[1]?s("Please first activate Slack, then save the settings and reload the admin area.","info"):s("Error. Response: "+JSON.stringify(e),"info"):s("Slack message successfully sent. Check Slack!","info"),t(this).sbLoading(!1)})),e.preventDefault(),!1}),t(y).on("click","#tab-slack",function(){let e=t(y).find("#slack-agents .input");t(e).html('<div class="sb-loading"></div>'),SBF.ajax({function:"slack-users"},i=>{let a="";if(SBF.errorValidation(i,"slack-token-not-found"))a=`<p>${o("Synchronize Slack and save changes before linking agents.")}</p>`;else{let t='<option value="-1"></option>';for(s=0;s<i.agents.length;s++)t+=`<option value="${i.agents[s].id}">${i.agents[s].name}</option>`;for(var s=0;s<i.slack_users.length;s++)a+=`<div data-id="${i.slack_users[s].id}"><label>${i.slack_users[s].name}</label><select>${t}</select></div>`}t(e).html(a),z.set("slack-agents",[i.saved,"double-select"])})}),t(y).on("click","#slack-archive-channels .sb-btn",function(e){t(this).sbLoading()||(t(this).sbLoading(!0),SBF.ajax({function:"archive-slack-channels"},e=>{!0===e&&s("Slack channels archived successfully!","info"),t(this).sbLoading(!1)})),e.preventDefault()}),W.is("wordpress")&&(t(y).on("click","#wp-synch .sb-btn",function(e){t(this).sbLoading()||(t(this).sbLoading(!0),SBF.ajax({function:"wp-synch"},e=>{!0===e?(J.update(),s("WordPress users successfully imported.","info")):s("Error. Response: "+JSON.stringify(e),"info"),t(this).sbLoading(!1)})),e.preventDefault()}),t("body").on("click","#wp-admin-bar-logout",function(){SBF.logout(!1)})),t(y).on("click","#tab-translations",function(){SBF.ajax({function:"get-translations"},e=>{let i,a="",s="";for(var r in e){let t=e[r].front,i=e[r].admin;a+=`<div data-code="${r}"><div data-area="front"><h2>${o("Front End")}<a class="sb-btn sb-icon sb-add-translation"><i class="sb-icon-plus"></i>${o("New translation")}</a></h2><div>`,s+=`<li data-code="${r}"><img src="${SB_URL}/media/flags/${r}.png" />${e[r].name}</li>`;for(var l in t)a+=`<div class="sb-input-setting sb-type-text"><label>${l}</label><div><input type="text" value="${t[l]}"></div></div>`;a+=`</div></div><div data-area="admin"><h2>${o("Admin")}</h2><div>`;for(var c in i)a+=`<div class="sb-input-setting sb-type-text"><label>${c}</label><div><input type="text" value="${i[c]}"></div></div>`;a+="</div></div></div>"}t(y).find(".sb-translations").html(`<div class="sb-nav"><div></div><ul>${s}</ul></div><div class="sb-content">${a}</div>`),i=t(y).find(".sb-translations > div > div:first-child"),t(i).sbActivate(),n(!1)}),n()}),t(y).on("click",".sb-add-translation",function(){t(this).closest('[data-area="front"]').find(" > div").prepend(`<div class="sb-input-setting sb-type-text sb-new-translation"><input type="text" placeholder="${o("Insert original text...")}"><input type="text" placeholder="${o("Insert translation...")}"></div></div>`)}),t(y).on("input",".sb-search-translation input",function(){let e=t(this).val().toLowerCase();SBF.search(e,()=>{e.length>1&&t(y).find(".sb-translations .sb-content > .sb-active label").each(function(){let i=t(this).html().toLowerCase();if(i.indexOf(e)>-1&&i!=A){let e=t(y).find(".sb-scroll-area");return t(e)[0].scrollTop=0,t(e)[0].scrollTop=t(this).position().top-80,A=i,!1}})})}),t(y).on("click",".sb-translations .sb-nav li",function(){let e=t(this).data("code");z.translations_to_update.includes(e)||z.translations_to_update.push(e)}),t(y).on("click","#tab-articles",function(){SBF.ajax({function:"get-articles",full:!0},e=>{if(!1!==e&&Array.isArray(e)){let a="",s=e.length;if(s){D=e;for(var i=0;i<s;i++)a+=`<li data-article-id="${D[i].id}">${D[i].title}<i class="sb-icon-delete"></i></li>`}else a=`<li class="sb-no-articles">${o("No articles found.")}</li>`;t(y).find(".sb-articles-area .sb-nav ul").html(a)}else SBF.error("Articles response not of type array or false","get-articles");n(!1)}),n()}),t(y).on("click",".sb-add-article",function(){let e=t(y).find(".sb-articles-area"),i=t(e).find(".sb-nav > ul"),a=SBF.random();z.articles("save"),D.push({id:a,title:"",content:"",link:""}),t(i).find(".sb-active").sbActivate(!1),t(i).find(".sb-no-articles").remove(),t(i).append(`<li class="sb-active" data-article-id="${a}">${o("Article")} ${t(i).find("li").length+1}<i class="sb-icon-delete"></i></li>`),t(e).find("input, textarea").val(""),t(e).find(".sb-content").attr("data-article-id",a)}),t(y).on("click",".sb-articles-area .sb-nav i",function(){s("The article will be deleted permanently.","alert",()=>{let e=t(this).closest(".sb-nav").find(" > ul");D.splice(t(this).parent().index(),1),t(e).find("li").length>1?t(this).parent().remove():t(e).html(`<li class="sb-no-articles">${o("No articles found.")}</li>`)})}),t(y).on("click",".sb-articles-area .sb-nav li",function(){let e=t(y).find(".sb-articles-area"),i=t(this).attr("data-article-id"),a=[-1,"","",""];z.articles("save");for(var s=0;s<D.length;s++)if(D[s].id==i){a=[i,D[s].title,D[s].content,D[s].link],t(this).siblings().sbActivate(!1),t(this).sbActivate();break}t(e).find(".sb-content").attr("data-article-id",a[0]),t(e).find(".sb-article-title input").val(a[1]),t(e).find(".sb-article-content textarea").val(a[2]),t(e).find(".sb-article-link input").val(a[3]),t(e).find("#sb-article-id").html(`ID <span>${a[0]}</span>`)}),t(h).on("click",".sb-panel-woocommerce > i",function(){W.woocommerce.conversationPanel()}),t(h).on("click",".sb-woocommerce-orders > div > span",function(e){let i=t(this).parent();t(e.target).is("span")&&(t(i).sbActive()||W.woocommerce.conversationPanelOrder(t(i).attr("data-id")))}),t(h).on("click",".sb-btn-woocommerce",function(){(t(E).sbLoading()||0!=a()&&a().language!=W.woocommerce.popupLanguage)&&W.woocommerce.popupPopulate(),t(I).sbTogglePopup(this)}),t(I).find(".sb-woocommerce-products-list").on("scroll",function(){u(this,!0)&&W.woocommerce.popupPagination(this)}),t(I).on("click",".sb-select li",function(){W.woocommerce.popupFilter(this)}),t(I).on("input",".sb-search-btn input",function(){W.woocommerce.popupSearch(this)}),t(I).on("click",".sb-search-btn i",function(){SBF.searchClear(this,()=>{W.woocommerce.popupSearch(t(this).next())})}),t(I).on("click",".sb-woocommerce-products-list li",function(){let e=t(I).attr("data-action"),i=t(this).data("id");SBF.null(e)?SBChat.insertText(`{product_card id="${i}"}`):(t(E).sbLoading(!0),t(h).find(".sb-add-cart-btn").sbLoading(!0),SBChat.sendMessage(-1,"",[],e=>{e&&(W.woocommerce.conversationPanelUpdate(i),t(p).sbHideLightbox())},{event:"woocommerce-update-cart",action:"cart-add",id:i})),SBF.deactivateAll(),t(p).removeClass("sb-popup-active")}),t(h).on("click",".sb-panel-woocommerce .sb-add-cart-btn",function(){t(this).sbLoading()||(SBChat.user_online?(W.woocommerce.popupPopulate(),t(I).sbShowLightbox(!0,"cart-add")):s("The user is offline. Only the carts of online users can be updated.","info"))}),t(h).on("click",".sb-panel-woocommerce .sb-list-items > a > i",function(e){let i=t(this).parent().attr("data-id");return SBChat.sendMessage(-1,"",[],()=>{W.woocommerce.conversationPanelUpdate(i,"removed")},{event:"woocommerce-update-cart",action:"cart-remove",id:i}),t(this).sbLoading(!0),e.preventDefault(),!1}),t(y).on("click","#wc-dialogflow-synch a, #wc-dialogflow-create-intents a",function(e){if(W.is("dialogflow")){if(!t(this).sbLoading()){let e=t(this).parent().attr("id");t(this).sbLoading(!0),SBF.ajax({function:"woocommerce-dialogflow-"+("wc-dialogflow-synch"==e?"entities":"intents")},e=>{t(this).sbLoading(!1),s(e?"Dialogflow synchronization completed.":"Error. Something went wrong.","info")})}}else s("This feature requires the Dialogflow App. Get it from the apps area.","info");return e.preventDefault(),!1}),t(h).on("click",".sb-panel-ump > i",function(){W.ump.conversationPanel()}),t(p).on("click",".sb-lightbox .sb-top-bar .sb-close",function(){t(p).sbHideLightbox()}),t(p).on("click",".sb-lightbox .sb-info",function(){t(this).sbActivate(!1)}),t(p).on("click",".sb-dialog-box a",function(){let e=t(this).closest(".sb-lightbox");t(this).hasClass("sb-confirm")&&B(),1==t(p).find(".sb-lightbox.sb-active").length&&t($).sbActivate(!1),t(e).sbActivate(!1)}),t(p).on("click",".sb-menu-wide li, .sb-nav li",function(){t(this).siblings().sbActivate(!1),t(this).sbActivate()}),t(p).on("click",".sb-nav li",function(){let e=t(this).closest(".sb-tab"),i=t(e).find(" > .sb-content > div").sbActivate(!1).eq(t(this).index());t(i).sbActivate(),t(i).find("textarea").each(function(){t(this).autoExpandTextarea(),t(this).manualExpandTextarea()}),t(e).find(".sb-scroll-area").scrollTop(0)}),t(p).find("[data-sb-tooltip]").each(function(){t(this).miniTip({content:t(this).attr("data-sb-tooltip"),anchor:"s",delay:500})}),t(p).on("click",'[data-button="toggle"]',function(){t(p).find("."+t(this).data("show")).addClass("sb-show-animation").show(),t(p).find("."+t(this).data("hide")).hide()}),t(p).on("click",".sb-info-card",function(){t(this).sbActivate(!1)}),t(p).on("change",".sb-upload-form-admin .sb-upload-files",function(e){t(this).sbUploadFiles(function(e){"success"==(e=JSON.parse(e))[0]?"upload-image"==t(k).closest("[data-type]").data("type")&&t(k).attr("data-value",e[1]).css("background-image",`url("${e[1]}")`):console.log(e[1])})}),t(p).on("click",".sb-accordion > div > span",function(e){let i=t(this).parent(),a=t(i).sbActive();t(e.target).is("span")&&(t(i).siblings().sbActivate(!1),t(i).sbActivate(!a))});else{let e=t(p).find(".sb-intall");t(p).on("click",".sb-submit-installation",function(){if(!t(this).sbLoading()){let i=!1,a=t(e).find("#first-name").length;if(t(this).sbLoading(!0),SBForm.errors(e))i=a?"All fields are required. Minimum password length is 8 characters. Be sure you've entered a valid email.":"All fields are required.";else if(a&&t(e).find("#password input").val()!=t(e).find("#password-check input").val())i="The passwords do not match.";else{let a=window.location.href.replace("/admin","").replace(".php","").replace(/#$|\/$/,"").replace(/#$|\/$/,"");t.ajax({method:"POST",url:a+"/include/ajax.php",data:{function:"installation",details:t.extend(SBForm.getAll(e),{url:a})}}).done(a=>{if(0!=(a=JSON.parse(a))){if(!0===(a=a[1]))return void setTimeout(()=>{window.location.href=window.location.href+"?refresh=true"},1e3);switch(a){case"connection-error":i="Support Board cannot connect to the database. Please check the database information and try again.";break;case"missing-details":i="Missing database details! Please check the database information and try again.";break;case"missing-url":i="Support Board cannot get the plugin URL.";break;default:i=a}}else i=a;!1!==i&&(SBForm.showErrorMessage(e,i),t("html, body").animate({scrollTop:0},500)),t(this).sbLoading(!1)})}!1!==i&&(SBForm.showErrorMessage(e,i),t("html, body").animate({scrollTop:0},500),t(this).sbLoading(!1))}})}})}(jQuery),function(t,e){"object"==typeof exports?module.exports=e(t):"function"==typeof define&&define.amd?define("colors",[],function(){return e(t)}):t.Colors=e(t)}(this,function(t,e){function i(t,i,s,n,o){if("string"==typeof i){s=(i=m.txt2color(i)).type,p[s]=i[s],o=o!==e?o:i.alpha}else if(i)for(var c in i)t[s][c]=r(i[c]/l[s][c][1],0,1);return o!==e&&(t.alpha=r(+o,0,1)),a(s,n?t:e)}function a(t,e){var i,a,r,f=e||p,h=m,b=u.options,v=l,g=f.RND,S="",_="",x={hsl:"hsv",rgb:t},y=g.rgb;if("alpha"!==t){for(var k in v)if(!v[k][k]){t!==k&&(_=x[k]||"rgb",f[k]=h[_+"2"+k](f[_])),g[k]||(g[k]={}),i=f[k];for(S in i)g[k][S]=d(i[S]*v[k][S][1])}y=g.rgb,f.HEX=h.RGB2HEX(y),f.equivalentGrey=b.grey.r*f.rgb.r+b.grey.g*f.rgb.g+b.grey.b*f.rgb.b,f.webSave=a=s(y,51),f.webSmart=r=s(y,17),f.saveColor=y.r===a.r&&y.g===a.g&&y.b===a.b?"web save":y.r===r.r&&y.g===r.g&&y.b===r.b?"web smart":"",f.hueRGB=m.hue2RGB(f.hsv.h),e&&(f.background=function(t,e,i){var a=u.options.grey,s={};return s.RGB={r:t.r,g:t.g,b:t.b},s.rgb={r:e.r,g:e.g,b:e.b},s.alpha=i,s.equivalentGrey=d(a.r*t.r+a.g*t.g+a.b*t.b),s.rgbaMixBlack=o(e,{r:0,g:0,b:0},i,1),s.rgbaMixWhite=o(e,{r:1,g:1,b:1},i,1),s.rgbaMixBlack.luminance=n(s.rgbaMixBlack,!0),s.rgbaMixWhite.luminance=n(s.rgbaMixWhite,!0),u.options.customBG&&(s.rgbaMixCustom=o(e,u.options.customBG,i,1),s.rgbaMixCustom.luminance=n(s.rgbaMixCustom,!0),u.options.customBG.luminance=n(u.options.customBG,!0)),s}(y,f.rgb,f.alpha))}var w,B,A,$=f.rgb,C=f.alpha,T="luminance",F=f.background;return w=o($,{r:0,g:0,b:0},C,1),w[T]=n(w,!0),f.rgbaMixBlack=w,B=o($,{r:1,g:1,b:1},C,1),B[T]=n(B,!0),f.rgbaMixWhite=B,b.customBG&&(A=o($,F.rgbaMixCustom,C,1),A[T]=n(A,!0),A.WCAG2Ratio=function(t,e){var i=1;return i=t>=e?(t+.05)/(e+.05):(e+.05)/(t+.05),d(100*i)/100}(A[T],F.rgbaMixCustom[T]),f.rgbaMixBGMixCustom=A,A.luminanceDelta=c.abs(A[T]-F.rgbaMixCustom[T]),A.hueDelta=function(t,e,i){return(c.max(t.r-e.r,e.r-t.r)+c.max(t.g-e.g,e.g-t.g)+c.max(t.b-e.b,e.b-t.b))*(i?255:1)/765}(F.rgbaMixCustom,A,!0)),f.RGBLuminance=n(y),f.HUELuminance=n(f.hueRGB),b.convertCallback&&b.convertCallback(f,t),f}function s(t,e){var i={},a=0,s=e/2;for(var n in t)a=t[n]%e,i[n]=t[n]+(a>s?e-a:-a);return i}function n(t,e){for(var i=e?1:255,a=[t.r/i,t.g/i,t.b/i],s=u.options.luminance,n=a.length;n--;)a[n]=a[n]<=.03928?a[n]/12.92:c.pow((a[n]+.055)/1.055,2.4);return s.r*a[0]+s.g*a[1]+s.b*a[2]}function o(t,i,a,s){var n={},o=a!==e?a:1,r=s!==e?s:1,l=o+r*(1-o);for(var c in t)n[c]=(t[c]*o+i[c]*r*(1-o))/l;return n.a=l,n}function r(t,e,i){return t>i?i:e>t?e:t}var l={rgb:{r:[0,255],g:[0,255],b:[0,255]},hsv:{h:[0,360],s:[0,100],v:[0,100]},hsl:{h:[0,360],s:[0,100],l:[0,100]},alpha:{alpha:[0,1]},HEX:{HEX:[0,16777215]}},c=t.Math,d=c.round,u={},p={},f={r:.298954,g:.586434,b:.114612},h={r:.2126,g:.7152,b:.0722},b=function(t){this.colors={RND:{}},this.options={color:"rgba(0,0,0,0)",grey:f,luminance:h,valueRanges:l},v(this,t||{})},v=function(t,a){var s,n=t.options;g(t);for(var o in a)a[o]!==e&&(n[o]=a[o]);s=n.customBG,n.customBG="string"==typeof s?m.txt2color(s).rgb:s,p=i(t.colors,n.color,e,!0)},g=function(t){u!==t&&(u=t,p=t.colors)};b.prototype.setColor=function(t,s,n){return g(this),t?i(this.colors,t,s,e,n):(n!==e&&(this.colors.alpha=r(n,0,1)),a(s))},b.prototype.setCustomBackground=function(t){return g(this),this.options.customBG="string"==typeof t?m.txt2color(t).rgb:t,i(this.colors,e,"rgb")},b.prototype.saveAsBackground=function(){return g(this),i(this.colors,e,"rgb",!0)},b.prototype.toString=function(t,e){return m.color2text((t||"rgb").toLowerCase(),this.colors,e)};var m={txt2color:function(t){var e={},i=t.replace(/(?:#|\)|%)/g,"").split("("),a=(i[1]||"").split(/,\s*/),s=i[1]?i[0].substr(0,3):"rgb",n="";if(e.type=s,e[s]={},i[1])for(var o=3;o--;)n=s[o]||s.charAt(o),e[s][n]=+a[o]/l[s][n][1];else e.rgb=m.HEX2rgb(i[0]);return e.alpha=a[3]?+a[3]:1,e},color2text:function(t,e,i){var a=!1!==i&&d(100*e.alpha)/100,s="number"==typeof a&&!1!==i&&(i||1!==a),n=e.RND.rgb,o=e.RND.hsl,r="hex"===t&&s,l="hex"===t&&!r,c="rgb"===t||r?n.r+", "+n.g+", "+n.b:l?"#"+e.HEX:o.h+", "+o.s+"%, "+o.l+"%";return l?c:(r?"rgb":t)+(s?"a":"")+"("+c+(s?", "+a:"")+")"},RGB2HEX:function(t){return((t.r<16?"0":"")+t.r.toString(16)+(t.g<16?"0":"")+t.g.toString(16)+(t.b<16?"0":"")+t.b.toString(16)).toUpperCase()},HEX2rgb:function(t){return t=t.split(""),{r:+("0x"+t[0]+t[t[3]?1:0])/255,g:+("0x"+t[t[3]?2:1]+(t[3]||t[1]))/255,b:+("0x"+(t[4]||t[2])+(t[5]||t[2]))/255}},hue2RGB:function(t){var e=6*t,i=~~e%6,a=6===e?0:e-i;return{r:d(255*[1,1-a,0,0,a,1][i]),g:d(255*[a,1,1,1-a,0,0][i]),b:d(255*[0,0,a,1,1,1-a][i])}},rgb2hsv:function(t){var e,i,a,s=t.r,n=t.g,o=t.b,r=0;return o>n&&(n=o+(o=n,0),r=-1),i=o,n>s&&(s=n+(n=s,0),r=-2/6-r,i=c.min(n,o)),e=s-i,a=s?e/s:0,{h:1e-15>a?p&&p.hsl&&p.hsl.h||0:e?c.abs(r+(n-o)/(6*e)):0,s:s?e/s:p&&p.hsv&&p.hsv.s||0,v:s}},hsv2rgb:function(t){var e=6*t.h,i=t.s,a=t.v,s=~~e,n=e-s,o=a*(1-i),r=a*(1-n*i),l=a*(1-(1-n)*i),c=s%6;return{r:[a,r,o,o,l,a][c],g:[l,a,a,r,o,o][c],b:[o,o,l,a,a,r][c]}},hsv2hsl:function(t){var e=(2-t.s)*t.v,i=t.s*t.v;return i=t.s?1>e?e?i/e:0:i/(2-e):0,{h:t.h,s:t.v||i?i:p&&p.hsl&&p.hsl.s||0,l:e/2}},rgb2hsl:function(t,e){var i=m.rgb2hsv(t);return m.hsv2hsl(e?i:p.hsv=i)},hsl2rgb:function(t){var e=6*t.h,i=t.s,a=t.l,s=.5>a?a*(1+i):a+i-i*a,n=a+a-s,o=~~e,r=s*(s?(s-n)/s:0)*(e-o),l=n+r,c=s-r,d=o%6;return{r:[s,c,n,n,l,s][d],g:[l,s,s,c,n,n][d],b:[n,n,l,s,s,c][d]}}};return b}),function(t,e){"object"==typeof exports?module.exports=e(t,require("jquery"),require("colors")):"function"==typeof define&&define.amd?define(["jquery","colors"],function(i,a){return e(t,i,a)}):e(t,t.jQuery,t.Colors)}(this,function(t,e,i,a){function s(t){return t.value||t.getAttribute("value")||e(t).css("background-color")||"#FFF"}function n(t){return(t=t.originalEvent&&t.originalEvent.touches?t.originalEvent.touches[0]:t).originalEvent?t.originalEvent:t}function o(t){return e(t.find(h.doRender)[0]||t[0])}function r(i){var a=e(this),n=a.offset(),r=e(t),u=h.gap;i?(b=o(a),b._colorMode=b.data("colorMode"),p.$trigger=a,(v||l()).css(h.positionCallback.call(p,a)||{left:(v._left=n.left)-((v._left+=v._width-(r.scrollLeft()+r.width()))+u>0?v._left+u:0),top:(v._top=n.top+a.outerHeight())-((v._top+=v._height-(r.scrollTop()+r.height()))+u>0?v._top+u:0)}).show(h.animationSpeed,function(){!0!==i&&(x.toggle(!!h.opacity)._width=x.width(),m._width=m.width(),m._height=m.height(),g._height=g.height(),f.setColor(s(b[0])),d(!0))}).off(".tcp").on(A,".cp-xy-slider,.cp-z-slider,.cp-alpha",c)):p.$trigger&&e(v).hide(h.animationSpeed,function(){d(!1),p.$trigger=null}).off(".tcp")}function l(){return e("head")[h.cssPrepend?"prepend":"append"]('<style type="text/css" id="tinyColorPickerStyles">'+(h.css||L)+(h.cssAddon||"")+"</style>"),e(F).css({margin:h.margin}).appendTo("body").show(0,function(){p.$UI=v=e(this),C=h.GPU&&v.css("perspective")!==a,g=e(".cp-z-slider",this),m=e(".cp-xy-slider",this),S=e(".cp-xy-cursor",this),_=e(".cp-z-cursor",this),x=e(".cp-alpha",this),y=e(".cp-alpha-cursor",this),h.buildCallback.call(p,v),v.prepend("<div>").children().eq(0).css("width",v.children().eq(0).width()),v._width=this.offsetWidth,v._height=this.offsetHeight}).hide()}function c(t){var i=this.className.replace(/cp-(.*?)(?:\s*|$)/,"$1").replace("-","_");(t.button||t.which)>1||(t.preventDefault&&t.preventDefault(),t.returnValue=!1,b._offset=e(this).offset(),(i="xy_slider"===i?function(t){var e=n(t),i=e.pageX-b._offset.left,a=e.pageY-b._offset.top;f.setColor({s:i/m._width*100,v:100-a/m._height*100},"hsv")}:"z_slider"===i?function(t){var e=n(t).pageY-b._offset.top;f.setColor({h:360-e/g._height*360},"hsv")}:function(t){var e=(n(t).pageX-b._offset.left)/x._width;f.setColor({},"rgb",e)})(t),d(),k.on($,function(){k.off(".tcp")}).on(B,function(t){i(t),d()}))}function d(t){var e=f.colors,i=e.hueRGB,s=(e.RND.rgb,e.RND.hsl,h.dark),n=h.light,o=f.toString(b._colorMode,h.forceAlpha),r=e.HUELuminance>.22?s:n,l=e.rgbaMixBlack.luminance>.22?s:n,c=(1-e.hsv.h)*g._height,d=e.hsv.s*m._width,p=(1-e.hsv.v)*m._height,v=e.alpha*x._width,k=C?"translate3d":"",w=b[0].value,B=b[0].hasAttribute("value")&&""===w&&t!==a;m._css={backgroundColor:"rgb("+i.r+","+i.g+","+i.b+")"},S._css={transform:k+"("+d+"px, "+p+"px, 0)",left:C?"":d,top:C?"":p,borderColor:e.RGBLuminance>.22?s:n},_._css={transform:k+"(0, "+c+"px, 0)",top:C?"":c,borderColor:"transparent "+r},x._css={backgroundColor:"#"+e.HEX},y._css={transform:k+"("+v+"px, 0, 0)",left:C?"":v,borderColor:l+" transparent"},b._css={backgroundColor:B?"":o,color:B?"":e.rgbaMixBGMixCustom.luminance>.22?s:n},b.text=B?"":w!==o?o:"",t!==a?u(t):T(u)}function u(t){m.css(m._css),S.css(S._css),_.css(_._css),x.css(x._css),y.css(y._css),h.doRender&&b.css(b._css),b.text&&b.val(b.text),h.renderCallback.call(p,b,"boolean"==typeof t?t:a)}var p,f,h,b,v,g,m,S,_,x,y,k=e(document),w=e(),B="touchmove.tcp mousemove.tcp pointermove.tcp",A="touchstart.tcp mousedown.tcp pointerdown.tcp",$="touchend.tcp mouseup.tcp pointerup.tcp",C=!1,T=t.requestAnimationFrame||t.webkitRequestAnimationFrame||function(t){t()},F='<div class="cp-color-picker"><div class="cp-z-slider"><div class="cp-z-cursor"></div></div><div class="cp-xy-slider"><div class="cp-white"></div><div class="cp-xy-cursor"></div></div><div class="cp-alpha"><div class="cp-alpha-cursor"></div></div></div>',L=".cp-color-picker{position:absolute;overflow:hidden;padding:6px 6px 0;background-color:#444;color:#bbb;font-family:Arial,Helvetica,sans-serif;font-size:12px;font-weight:400;cursor:default;border-radius:5px}.cp-color-picker>div{position:relative;overflow:hidden}.cp-xy-slider{float:left;height:128px;width:128px;margin-bottom:6px;background:linear-gradient(to right,#FFF,rgba(255,255,255,0))}.cp-white{height:100%;width:100%;background:linear-gradient(rgba(0,0,0,0),#000)}.cp-xy-cursor{position:absolute;top:0;width:10px;height:10px;margin:-5px;border:1px solid #fff;border-radius:100%;box-sizing:border-box}.cp-z-slider{float:right;margin-left:6px;height:128px;width:20px;background:linear-gradient(red 0,#f0f 17%,#00f 33%,#0ff 50%,#0f0 67%,#ff0 83%,red 100%)}.cp-z-cursor{position:absolute;margin-top:-4px;width:100%;border:4px solid #fff;border-color:transparent #fff;box-sizing:border-box}.cp-alpha{clear:both;width:100%;height:16px;margin:6px 0;background:linear-gradient(to right,#444,rgba(0,0,0,0))}.cp-alpha-cursor{position:absolute;margin-left:-4px;height:100%;border:4px solid #fff;border-color:#fff transparent;box-sizing:border-box}",I=function(t){f=this.color=new i(t),h=f.options,p=this};I.prototype={render:d,toggle:r},e.fn.colorPicker=function(i){var a=this,n=function(){};return i=e.extend({animationSpeed:150,GPU:!0,doRender:!0,customBG:"#FFF",opacity:!0,renderCallback:n,buildCallback:n,positionCallback:n,body:document.body,scrollResize:!0,gap:4,dark:"#222",light:"#DDD"},i),!p&&i.scrollResize&&e(t).on("resize.tcp scroll.tcp",function(){p.$trigger&&p.toggle.call(p.$trigger[0],!0)}),w=w.add(this),this.colorPicker=p||new I(i),this.options=i,e(i.body).off(".tcp").on(A,function(t){-1===w.add(v).add(e(v).find(t.target)).index(t.target)&&r()}),this.on("focusin.tcp click.tcp",function(t){p.color.options=e.extend(p.color.options,h=a.options),r.call(this,t)}).on("change.tcp",function(){f.setColor(this.value||"#FFF"),a.colorPicker.render(!0)}).each(function(){var t=s(this),a=t.split("("),n=o(e(this));n.data("colorMode",a[1]?a[0].substr(0,3):"HEX").attr("readonly",h.preventFocus),i.doRender&&n.css({"background-color":t,color:function(){return f.setColor(t).rgbaMixBGMixCustom.luminance>.22?i.dark:i.light}})})},e.fn.colorPicker.destroy=function(){e("*").off(".tcp"),p.toggle(!1),w=e()}});